import{Q as Ue}from"./QBadge.9e6b5a46.js";import{u as Le,a as ze,b as Ee,g as We,Q as we,c as Xe}from"./QPopupProxy.d9e44b94.js";import{j as Ze,x as Ge,aL as Je,z as et,aM as tt,r as x,c as v,w as De,ao as lt,k as ut,h as d,g as at,aN as nt,p as ot,aO as it,a7 as st,D as fe,a4 as j,_ as rt,P as dt,a1 as ct,o as vt,Q as mt,a5 as ft,d as h,U as P,Z as ht,$ as pt,aa as m,a9 as re}from"./index.dc551ac6.js";import{T as _t}from"./TouchPan.50611bdf.js";import{_ as ee,f as gt,d as R}from"./date.ccb51cc0.js";import{p as T}from"./format.c860d4da.js";import{u as yt,Q as kt}from"./QSpace.09ccd3fc.js";import{Q as wt,r as B,n as de,p as ce,m as ve}from"./index.935bf3a0.js";import{C as be}from"./ClosePopup.606a8f34.js";import{_ as K}from"./CInput.13e1ce53.js";import{emitter as Ce}from"./mitt.4e333a4b.js";import{u as Dt}from"./settingsStore.6d20ebcd.js";import{R as bt}from"./dexie.8617b804.js";import{r as me}from"./index.815fece1.js";import"./use-cache.b0833c75.js";import"./QMenu.b4d70c81.js";import"./selection.badb18f8.js";import"./touch.3df10340.js";import"./i18n.2b9c7e98.js";import"./fuelConsumption.d2d2c6e8.js";import"./index.6de444b0.js";function Ct(l,H){if(l.hour!==null){if(l.minute===null)return"minute";if(H===!0&&l.second===null)return"second"}return"hour"}function qt(){const l=new Date;return{hour:l.getHours(),minute:l.getMinutes(),second:l.getSeconds(),millisecond:l.getMilliseconds()}}var Mt=Ze({name:"QTime",props:{...Ge,...Je,...Le,mask:{default:null},format24h:{type:Boolean,default:null},defaultDate:{type:String,validator:l=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(l)},options:Function,hourOptions:Array,minuteOptions:Array,secondOptions:Array,withSeconds:Boolean,nowBtn:Boolean},emits:ze,setup(l,{slots:H,emit:O}){const S=at(),{$q:D}=S.proxy,r=et(l,D),{tabindex:k,headerClass:V,getLocale:U,getCurrentDate:q}=Ee(l,D),te=tt(l),le=nt(te);let Y,I;const p=x(null),o=v(()=>Ae()),b=v(()=>U()),M=v(()=>He()),g=ee(l.modelValue,o.value,b.value,l.calendar,M.value),n=x(Ct(g)),u=x(g),f=x(g.hour===null||g.hour<12),qe=v(()=>`q-time q-time--${l.landscape===!0?"landscape":"portrait"}`+(r.value===!0?" q-time--dark q-dark":"")+(l.disable===!0?" disabled":l.readonly===!0?" q-time--readonly":"")+(l.bordered===!0?" q-time--bordered":"")+(l.square===!0?" q-time--square no-border-radius":"")+(l.flat===!0?" q-time--flat no-shadow":"")),ue=v(()=>{const e=u.value;return{hour:e.hour===null?"--":y.value===!0?T(e.hour):String(f.value===!0?e.hour===0?12:e.hour:e.hour>12?e.hour-12:e.hour),minute:e.minute===null?"--":T(e.minute),second:e.second===null?"--":T(e.second)}}),y=v(()=>l.format24h!==null?l.format24h:D.lang.date.format24h),Me=v(()=>{const e=n.value==="hour",t=e===!0?12:60,a=u.value[n.value];let c=`rotate(${Math.round(a*(360/t))-180}deg) translateX(-50%)`;return e===!0&&y.value===!0&&u.value.hour>=12&&(c+=" scale(.7)"),{transform:c}}),he=v(()=>u.value.hour!==null),xe=v(()=>he.value===!0&&u.value.minute!==null),F=v(()=>l.hourOptions!==void 0?e=>l.hourOptions.includes(e):l.options!==void 0?e=>l.options(e,null,null):null),L=v(()=>l.minuteOptions!==void 0?e=>l.minuteOptions.includes(e):l.options!==void 0?e=>l.options(u.value.hour,e,null):null),z=v(()=>l.secondOptions!==void 0?e=>l.secondOptions.includes(e):l.options!==void 0?e=>l.options(u.value.hour,u.value.minute,e):null),C=v(()=>{if(F.value===null)return null;const e=W(0,11,F.value),t=W(12,11,F.value);return{am:e,pm:t,values:e.values.concat(t.values)}}),N=v(()=>L.value!==null?W(0,59,L.value):null),Q=v(()=>z.value!==null?W(0,59,z.value):null),E=v(()=>{switch(n.value){case"hour":return C.value;case"minute":return N.value;case"second":return Q.value}}),Se=v(()=>{let e,t,a=0,s=1;const c=E.value!==null?E.value.values:void 0;n.value==="hour"?y.value===!0?(e=0,t=23):(e=0,t=11,f.value===!1&&(a=12)):(e=0,t=55,s=5);const w=[];for(let i=e,_=e;i<=t;i+=s,_++){const A=i+a,Ke=c!==void 0&&c.includes(A)===!1,je=n.value==="hour"&&i===0?y.value===!0?"00":"12":i;w.push({val:A,index:_,disable:Ke,label:je})}return w}),Ve=v(()=>[[_t,Oe,void 0,{stop:!0,prevent:!0,mouse:!0}]]);De(()=>l.modelValue,e=>{const t=ee(e,o.value,b.value,l.calendar,M.value);(t.dateHash!==u.value.dateHash||t.timeHash!==u.value.timeHash)&&(u.value=t,t.hour===null?n.value="hour":f.value=t.hour<12)}),De([o,b],()=>{ot(()=>{se()})});function pe(){const e={...q(),...qt()};se(e),Object.assign(u.value,e),n.value="hour"}function W(e,t,a){const s=Array.apply(null,{length:t+1}).map((c,w)=>{const i=w+e;return{index:i,val:a(i)===!0}}).filter(c=>c.val===!0).map(c=>c.index);return{min:s[0],max:s[s.length-1],values:s,threshold:t+1}}function _e(e,t,a){const s=Math.abs(e-t);return Math.min(s,a-s)}function ae(e,{min:t,max:a,values:s,threshold:c}){if(e===t)return t;if(e<t||e>a)return _e(e,t,c)<=_e(e,a,c)?t:a;const w=s.findIndex(A=>e<=A),i=s[w-1],_=s[w];return e-i<=_-e?i:_}function Ae(){return l.calendar!=="persian"&&l.mask!==null?l.mask:`HH:mm${l.withSeconds===!0?":ss":""}`}function He(){if(typeof l.defaultDate!="string"){const e=q(!0);return e.dateHash=We(e),e}return ee(l.defaultDate,"YYYY/MM/DD",void 0,l.calendar)}function ne(){return it(S)===!0||E.value!==null&&(E.value.values.length===0||n.value==="hour"&&y.value!==!0&&C.value[f.value===!0?"am":"pm"].values.length===0)}function oe(){const e=p.value,{top:t,left:a,width:s}=e.getBoundingClientRect(),c=s/2;return{top:t+c,left:a+c,dist:c*.7}}function Oe(e){if(ne()!==!0){if(e.isFirst===!0){Y=oe(),I=X(e.evt,Y);return}I=X(e.evt,Y,I),e.isFinal===!0&&(Y=!1,I=null,ge())}}function ge(){n.value==="hour"?n.value="minute":l.withSeconds&&n.value==="minute"&&(n.value="second")}function X(e,t,a){const s=lt(e),c=Math.abs(s.top-t.top),w=Math.sqrt(Math.pow(Math.abs(s.top-t.top),2)+Math.pow(Math.abs(s.left-t.left),2));let i,_=Math.asin(c/w)*(180/Math.PI);if(s.top<t.top?_=t.left<s.left?90-_:270+_:_=t.left<s.left?_+90:270-_,n.value==="hour"){if(i=_/30,C.value!==null){const A=y.value!==!0?f.value===!0:C.value.am.values.length!==0&&C.value.pm.values.length!==0?w>=t.dist:C.value.am.values.length!==0;i=ae(i+(A===!0?0:12),C.value[A===!0?"am":"pm"])}else i=Math.round(i),y.value===!0?w<t.dist?i<12&&(i+=12):i===12&&(i=0):f.value===!0&&i===12?i=0:f.value===!1&&i!==12&&(i+=12);y.value===!0&&(f.value=i<12)}else i=Math.round(_/6)%60,n.value==="minute"&&N.value!==null?i=ae(i,N.value):n.value==="second"&&Q.value!==null&&(i=ae(i,Q.value));return a!==i&&Qe[n.value](i),i}const ie={hour(){n.value="hour"},minute(){n.value="minute"},second(){n.value="second"}};function Ye(e){e.keyCode===13&&ye()}function Ie(e){e.keyCode===13&&ke()}function Pe(e){ne()!==!0&&(D.platform.is.desktop!==!0&&X(e,oe()),ge())}function Re(e){ne()!==!0&&X(e,oe())}function Te(e){if(e.keyCode===13)n.value="hour";else if([37,39].includes(e.keyCode)){const t=e.keyCode===37?-1:1;if(C.value!==null){const a=y.value===!0?C.value.values:C.value[f.value===!0?"am":"pm"].values;if(a.length===0)return;if(u.value.hour===null)Z(a[0]);else{const s=(a.length+a.indexOf(u.value.hour)+t)%a.length;Z(a[s])}}else{const a=y.value===!0?24:12,s=y.value!==!0&&f.value===!1?12:0,c=u.value.hour===null?-t:u.value.hour;Z(s+(24+c+t)%a)}}}function Fe(e){if(e.keyCode===13)n.value="minute";else if([37,39].includes(e.keyCode)){const t=e.keyCode===37?-1:1;if(N.value!==null){const a=N.value.values;if(a.length===0)return;if(u.value.minute===null)G(a[0]);else{const s=(a.length+a.indexOf(u.value.minute)+t)%a.length;G(a[s])}}else{const a=u.value.minute===null?-t:u.value.minute;G((60+a+t)%60)}}}function Ne(e){if(e.keyCode===13)n.value="second";else if([37,39].includes(e.keyCode)){const t=e.keyCode===37?-1:1;if(Q.value!==null){const a=Q.value.values;if(a.length===0)return;if(u.value.seconds===null)J(a[0]);else{const s=(a.length+a.indexOf(u.value.second)+t)%a.length;J(a[s])}}else{const a=u.value.second===null?-t:u.value.second;J((60+a+t)%60)}}}function Z(e){u.value.hour!==e&&(u.value.hour=e,$())}function G(e){u.value.minute!==e&&(u.value.minute=e,$())}function J(e){u.value.second!==e&&(u.value.second=e,$())}const Qe={hour:Z,minute:G,second:J};function ye(){f.value===!1&&(f.value=!0,u.value.hour!==null&&(u.value.hour-=12,$()))}function ke(){f.value===!0&&(f.value=!1,u.value.hour!==null&&(u.value.hour+=12,$()))}function $(){if(F.value!==null&&F.value(u.value.hour)!==!0){u.value=ee(),n.value="hour";return}if(L.value!==null&&L.value(u.value.minute)!==!0){u.value.minute=null,u.value.second=null,n.value="minute";return}if(l.withSeconds===!0&&z.value!==null&&z.value(u.value.second)!==!0){u.value.second=null,n.value="second";return}u.value.hour===null||u.value.minute===null||l.withSeconds===!0&&u.value.second===null||se()}function se(e){const t=Object.assign({...u.value},e),a=l.calendar==="persian"?T(t.hour)+":"+T(t.minute)+(l.withSeconds===!0?":"+T(t.second):""):gt(new Date(t.year,t.month===null?null:t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond),o.value,b.value,t.year,t.timezoneOffset);t.changed=a!==l.modelValue,O("update:modelValue",a,t)}function $e(){const e=[d("div",{class:"q-time__link "+(n.value==="hour"?"q-time__link--active":"cursor-pointer"),tabindex:k.value,onClick:ie.hour,onKeyup:Te},ue.value.hour),d("div",":"),d("div",he.value===!0?{class:"q-time__link "+(n.value==="minute"?"q-time__link--active":"cursor-pointer"),tabindex:k.value,onKeyup:Fe,onClick:ie.minute}:{class:"q-time__link"},ue.value.minute)];l.withSeconds===!0&&e.push(d("div",":"),d("div",xe.value===!0?{class:"q-time__link "+(n.value==="second"?"q-time__link--active":"cursor-pointer"),tabindex:k.value,onKeyup:Ne,onClick:ie.second}:{class:"q-time__link"},ue.value.second));const t=[d("div",{class:"q-time__header-label row items-center no-wrap",dir:"ltr"},e)];return y.value===!1&&t.push(d("div",{class:"q-time__header-ampm column items-between no-wrap"},[d("div",{class:"q-time__link "+(f.value===!0?"q-time__link--active":"cursor-pointer"),tabindex:k.value,onClick:ye,onKeyup:Ye},"AM"),d("div",{class:"q-time__link "+(f.value!==!0?"q-time__link--active":"cursor-pointer"),tabindex:k.value,onClick:ke,onKeyup:Ie},"PM")])),d("div",{class:"q-time__header flex flex-center no-wrap "+V.value},t)}function Be(){const e=u.value[n.value];return d("div",{class:"q-time__content col relative-position"},[d(st,{name:"q-transition--scale"},()=>d("div",{key:"clock"+n.value,class:"q-time__container-parent absolute-full"},[d("div",{ref:p,class:"q-time__container-child fit overflow-hidden"},[fe(d("div",{class:"q-time__clock cursor-pointer non-selectable",onClick:Pe,onMousedown:Re},[d("div",{class:"q-time__clock-circle fit"},[d("div",{class:"q-time__clock-pointer"+(u.value[n.value]===null?" hidden":l.color!==void 0?` text-${l.color}`:""),style:Me.value}),Se.value.map(t=>d("div",{class:`q-time__clock-position row flex-center q-time__clock-pos-${t.index}`+(t.val===e?" q-time__clock-position--active "+V.value:t.disable===!0?" q-time__clock-position--disable":"")},[d("span",t.label)]))])]),Ve.value)])])),l.nowBtn===!0?d(j,{class:"q-time__now-button absolute",icon:D.iconSet.datetime.now,unelevated:!0,size:"sm",round:!0,color:l.color,textColor:l.textColor,tabindex:k.value,onClick:pe}):null])}return S.proxy.setNow=pe,()=>{const e=[Be()],t=ut(H.default);return t!==void 0&&e.push(d("div",{class:"q-time__actions"},t)),l.name!==void 0&&l.disable!==!0&&le(e,"push"),d("div",{class:qe.value,tabindex:-1},[$e(),d("div",{class:"q-time__main col overflow-auto"},e)])}}});const xt={class:"row items-center justify-end"},St={class:"row items-center justify-end"},Vt={class:"row"},At=dt({__name:"RefuelForm",props:{id:{type:Number}},setup(l){const H=l,O=ct(),S=yt(),D=Dt(),r=x(new bt),k=x(R.formatDate(Date.now(),"YYYY/MM/DD")),V=x(R.formatDate(Date.now(),"HH:mm")),U=x("");let q="";function te(p){const o=new Date(p);k.value=R.formatDate(o,"YYYY/MM/DD"),r.value.date||(r.value.date=o),r.value.date.setFullYear(o.getFullYear()),r.value.date.setMonth(o.getMonth()),r.value.date.setDate(o.getDate())}function le(p){const o=p.split(":"),b=parseInt(o[0]),M=parseInt(o[1]),g=new Date(Date.now());r.value.date||(r.value.date=g),g.setHours(b),g.setMinutes(M),V.value=R.formatDate(g,"HH:mm"),r.value.date.setHours(b),r.value.date.setMinutes(M)}async function Y(){let p=r.value;q.includes("/add")?p.id=await S.addRefuel({...r.value}):q.includes("/edit")&&await S.updateRefuel({...r.value});const o=p&&p.id?p.id:0;O.push({path:`/refuels/${o}`,params:{id:o}})}function I(){r.value.id?O.push({path:`/refuels/${r.value.id}`,params:{id:r.value.id}}):O.go(-1)}return vt(async()=>{var p;if(q=O.currentRoute.value.path.toLocaleLowerCase(),q.includes("/add")?Ce.emit("updateTitle","Add refuel"):q.includes("/edit")&&Ce.emit("updateTitle","Edit refuel"),U.value=D.plateNumberInTitleActive?D.selectedVehiclePlateNumber:D.selectedVehicleName,r.value.vehicleId=(p=D.selectedVehicleId)!=null?p:0,H.id){const o=await S.getRefuel(H.id);o?(r.value.id=o.id,r.value.payedAmount=o.payedAmount,r.value.refueledAmount=o.refueledAmount,r.value.distanceDriven=o.distanceDriven,q.includes("/edit")&&(r.value.date=o.date,k.value=R.formatDate(o.date,"YYYY/MM/DD"),V.value=R.formatDate(o.date,"HH:mm"))):console.error("Refuel not found!")}else r.value.date=new Date(Date.now())}),(p,o)=>(mt(),ft("div",null,[h(wt,{onSubmit:Y,class:"q-px-md q-gutter-md"},{default:P(()=>{var b,M,g;return[h(Ue,{align:"top"},{default:P(()=>[ht(pt(U.value),1)]),_:1}),h(K,{type:"tel",value:(b=r.value.payedAmount)==null?void 0:b.toString(),"onUpdate:modelValue":o[0]||(o[0]=n=>r.value.payedAmount=+m(me)(n)),label:"Payed amount",rules:[m(B),m(de),m(ce),m(ve)],autofocus:""},null,8,["value","rules"]),h(K,{type:"tel",value:(M=r.value.distanceDriven)==null?void 0:M.toString(),"onUpdate:modelValue":o[1]||(o[1]=n=>r.value.distanceDriven=+m(me)(n)),label:"Distance driven",rules:[m(B),m(de),m(ce),m(ve)]},null,8,["value","rules"]),h(K,{type:"tel",value:(g=r.value.refueledAmount)==null?void 0:g.toString(),"onUpdate:modelValue":o[2]||(o[2]=n=>r.value.refueledAmount=+m(me)(n)),label:"Refueled amount",rules:[m(B),m(de),m(ce),m(ve)]},null,8,["value","rules"]),h(K,{value:k.value,label:"Refuel date",rules:[m(B)]},{default:P(()=>[h(we,{"transition-show":"scale","transition-hide":"scale"},{default:P(()=>[h(Xe,{modelValue:k.value,"onUpdate:modelValue":o[3]||(o[3]=n=>te(n))},null,8,["modelValue"]),re("div",xt,[fe(h(j,{label:"Close",color:"primary",flat:""},null,512),[[be]])])]),_:1})]),_:1},8,["value","rules"]),h(K,{value:V.value,label:"Refuel time",rules:[m(B)]},{default:P(()=>[h(we,{"transition-show":"scale","transition-hide":"scale"},{default:P(()=>[h(Mt,{modelValue:V.value,"onUpdate:modelValue":o[4]||(o[4]=n=>le(n)),format24h:""},null,8,["modelValue"]),re("div",St,[fe(h(j,{label:"Close",color:"primary",flat:""},null,512),[[be]])])]),_:1})]),_:1},8,["value","rules"]),re("div",Vt,[h(j,{color:"negative",label:"Cancel","no-caps":"",class:"btn",onClick:I}),h(kt),h(j,{color:"positive",label:"Confirm",type:"submit","no-caps":"",class:"btn"})])]}),_:1})]))}});var Gt=rt(At,[["__scopeId","data-v-972a8e7c"]]);export{Gt as default};
