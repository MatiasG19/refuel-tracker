var vr=Object.defineProperty;var pr=(t,e,n)=>e in t?vr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var R=(t,e,n)=>(pr(t,typeof e!="symbol"?e+"":e,n),n);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var I=function(){return I=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},I.apply(this,arguments)};function Pt(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,a;r<i;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return t.concat(a||Array.prototype.slice.call(e))}var F=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,j=Object.keys,z=Array.isArray;typeof Promise!="undefined"&&!F.Promise&&(F.Promise=Promise);function H(t,e){return typeof e!="object"||j(e).forEach(function(n){t[n]=e[n]}),t}var Ue=Object.getPrototypeOf,yr={}.hasOwnProperty;function G(t,e){return yr.call(t,e)}function Ce(t,e){typeof e=="function"&&(e=e(Ue(t))),(typeof Reflect=="undefined"?j:Reflect.ownKeys)(e).forEach(function(n){se(t,n,e[n])})}var Bn=Object.defineProperty;function se(t,e,n,r){Bn(t,e,H(n&&G(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Te(t){return{from:function(e){return t.prototype=Object.create(e.prototype),se(t.prototype,"constructor",t),{extend:Ce.bind(null,t.prototype)}}}}var mr=Object.getOwnPropertyDescriptor;function rn(t,e){var n=mr(t,e),r;return n||(r=Ue(t))&&rn(r,e)}var gr=[].slice;function wt(t,e,n){return gr.call(t,e,n)}function On(t,e){return e(t)}function Oe(t){if(!t)throw new Error("Assertion Failed")}function Mn(t){F.setImmediate?setImmediate(t):setTimeout(t,0)}function Fn(t,e){return t.reduce(function(n,r,i){var a=e(r,i);return a&&(n[a[0]]=a[1]),n},{})}function br(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function oe(t,e){if(typeof e=="string"&&G(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var a=oe(t,e[r]);n.push(a)}return n}var u=e.indexOf(".");if(u!==-1){var o=t[e.substr(0,u)];return o===void 0?void 0:oe(o,e.substr(u+1))}}function $(t,e,n){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Oe(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)$(t,e[r],n[r])}else{var a=e.indexOf(".");if(a!==-1){var u=e.substr(0,a),o=e.substr(a+1);if(o==="")n===void 0?z(t)&&!isNaN(parseInt(u))?t.splice(u,1):delete t[u]:t[u]=n;else{var s=t[u];(!s||!G(t,u))&&(s=t[u]={}),$(s,o,n)}}else n===void 0?z(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function _r(t,e){typeof e=="string"?$(t,e,void 0):"length"in e&&[].map.call(e,function(n){$(t,n,void 0)})}function Nn(t){var e={};for(var n in t)G(t,n)&&(e[n]=t[n]);return e}var wr=[].concat;function jn(t){return wr.apply([],t)}var Un="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(jn([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return F[t]}),xr=Un.map(function(t){return F[t]});Fn(Un,function(t){return[t,!0]});var de=null;function Ge(t){de=typeof WeakMap!="undefined"&&new WeakMap;var e=Bt(t);return de=null,e}function Bt(t){if(!t||typeof t!="object")return t;var e=de&&de.get(t);if(e)return e;if(z(t)){e=[],de&&de.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Bt(t[n]))}else if(xr.indexOf(t.constructor)>=0)e=t;else{var i=Ue(t);e=i===Object.prototype?{}:Object.create(i),de&&de.set(t,e);for(var a in t)G(t,a)&&(e[a]=Bt(t[a]))}return e}var Er={}.toString;function Ot(t){return Er.call(t).slice(8,-1)}var Mt=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",Ar=typeof Mt=="symbol"?function(t){var e;return t!=null&&(e=t[Mt])&&e.apply(t)}:function(){return null},Ke={};function ae(t){var e,n,r,i;if(arguments.length===1){if(z(t))return t.slice();if(this===Ke&&typeof t=="string")return[t];if(i=Ar(t)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var an=typeof Symbol!="undefined"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ne=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ln(t,e){ne=t,Vn=e}var Vn=function(){return!0},Sr=!new Error("").stack;function Ae(){if(Sr)try{throw Ae.arguments,new Error}catch(t){return t}return new Error}function Ft(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(Vn).map(function(r){return`
`+r}).join("")):""}var Dr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],zn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],un=Dr.concat(zn),Kr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ie(t,e){this._e=Ae(),this.name=t,this.message=e}Te(Ie).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Ft(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Wn(t,e){return t+". Errors: "+Object.keys(e).map(function(n){return e[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function ht(t,e,n,r){this._e=Ae(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Wn(t,e)}Te(ht).from(Ie);function Fe(t,e){this._e=Ae(),this.name="BulkError",this.failures=Object.keys(e).map(function(n){return e[n]}),this.failuresByPos=e,this.message=Wn(t,e)}Te(Fe).from(Ie);var on=un.reduce(function(t,e){return t[e]=e+"Error",t},{}),kr=Ie,k=un.reduce(function(t,e){var n=e+"Error";function r(i,a){this._e=Ae(),this.name=n,i?typeof i=="string"?(this.message=""+i+(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message=i.name+" "+i.message,this.inner=i):(this.message=Kr[e]||n,this.inner=null)}return Te(r).from(kr),t[e]=r,t},{});k.Syntax=SyntaxError;k.Type=TypeError;k.Range=RangeError;var wn=zn.reduce(function(t,e){return t[e+"Error"]=k[e],t},{});function Cr(t,e){if(!t||t instanceof Ie||t instanceof TypeError||t instanceof SyntaxError||!t.name||!wn[t.name])return t;var n=new wn[t.name](e||t.message,t);return"stack"in t&&se(n,"stack",{get:function(){return this.inner.stack}}),n}var xt=un.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=k[e]),t},{});xt.ModifyError=ht;xt.DexieError=Ie;xt.BulkError=Fe;function M(){}function Qe(t){return t}function Tr(t,e){return t==null||t===Qe?e:function(n){return e(t(n))}}function xe(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Ir(t,e){return t===M?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?xe(r,this.onsuccess):r),i&&(this.onerror=this.onerror?xe(i,this.onerror):i),a!==void 0?a:n}}function Rr(t,e){return t===M?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?xe(n,this.onsuccess):n),r&&(this.onerror=this.onerror?xe(r,this.onerror):r)}}function Pr(t,e){return t===M?e:function(n){var r=t.apply(this,arguments);H(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var u=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?xe(i,this.onsuccess):i),a&&(this.onerror=this.onerror?xe(a,this.onerror):a),r===void 0?u===void 0?void 0:u:H(r,u)}}function Br(t,e){return t===M?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function sn(t,e){return t===M?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then(function(){return e.apply(r,a)})}return e.apply(this,arguments)}}var Le={},Or=100,Mr=20,Hn=100,cn=typeof Promise=="undefined"?[]:function(){var t=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[t,Ue(t),t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Ue(e),t]}(),Nt=cn[0],dt=cn[1],jt=cn[2],Yn=dt&&dt.then,ut=Nt&&Nt.constructor,ln=!!jt,Ut=!1,Fr=jt?function(){jt.then(et)}:F.setImmediate?setImmediate.bind(null,et):F.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){et(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(et,0)},Ve=function(t,e){Me.push([t,e]),vt&&(Fr(),vt=!1)},Lt=!0,vt=!0,_e=[],ot=[],Vt=null,zt=Qe,ke={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:An,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{An(t[0],t[1])}catch{}})}},S=ke,Me=[],we=0,st=[];function A(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=M,this._lib=!1;var e=this._PSD=S;if(ne&&(this._stackHolder=Ae(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Le)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Ht(this,this._value);return}this._state=null,this._value=null,++e.ref,Qn(this,t)}var Wt={get:function(){var t=S,e=pt;function n(r,i){var a=this,u=!t.global&&(t!==S||e!==pt),o=u&&!ce(),s=new A(function(c,h){fn(a,new Gn(mt(r,t,u,o),mt(i,t,u,o),c,h,t))});return ne&&Jn(s,this),s}return n.prototype=Le,n},set:function(t){se(this,"then",t&&t.prototype===Le?Wt:{get:function(){return t},set:Wt.set})}};Ce(A.prototype,{then:Wt,_then:function(t,e){fn(this,new Gn(null,null,t,e,S))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,function(r){return r instanceof e?n(r):ct(r)}):this.then(null,function(r){return r&&r.name===e?n(r):ct(r)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),ct(e)})},stack:{get:function(){if(this._stack)return this._stack;try{Ut=!0;var t=qn(this,[],Mr),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Ut=!1}}},timeout:function(t,e){var n=this;return t<1/0?new A(function(r,i){var a=setTimeout(function(){return i(new k.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&se(A.prototype,Symbol.toStringTag,"Dexie.Promise");ke.env=$n();function Gn(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}Ce(A,{all:function(){var t=ae.apply(null,arguments).map(yt);return new A(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach(function(i,a){return A.resolve(i).then(function(u){t[a]=u,--r||e(t)},n)})})},resolve:function(t){if(t instanceof A)return t;if(t&&typeof t.then=="function")return new A(function(n,r){t.then(n,r)});var e=new A(Le,!0,t);return Jn(e,Vt),e},reject:ct,race:function(){var t=ae.apply(null,arguments).map(yt);return new A(function(e,n){t.map(function(r){return A.resolve(r).then(e,n)})})},PSD:{get:function(){return S},set:function(t){return S=t}},totalEchoes:{get:function(){return pt}},newPSD:pe,usePSD:Pe,scheduler:{get:function(){return Ve},set:function(t){Ve=t}},rejectionMapper:{get:function(){return zt},set:function(t){zt=t}},follow:function(t,e){return new A(function(n,r){return pe(function(i,a){var u=S;u.unhandleds=[],u.onunhandled=a,u.finalize=xe(function(){var o=this;jr(function(){o.unhandleds.length===0?i():a(o.unhandleds[0])})},u.finalize),t()},e,n,r)})}});ut&&(ut.allSettled&&se(A,"allSettled",function(){var t=ae.apply(null,arguments).map(yt);return new A(function(e){t.length===0&&e([]);var n=t.length,r=new Array(n);t.forEach(function(i,a){return A.resolve(i).then(function(u){return r[a]={status:"fulfilled",value:u}},function(u){return r[a]={status:"rejected",reason:u}}).then(function(){return--n||e(r)})})})}),ut.any&&typeof AggregateError!="undefined"&&se(A,"any",function(){var t=ae.apply(null,arguments).map(yt);return new A(function(e,n){t.length===0&&n(new AggregateError([]));var r=t.length,i=new Array(r);t.forEach(function(a,u){return A.resolve(a).then(function(o){return e(o)},function(o){i[u]=o,--r||n(new AggregateError(i))})})})}));function Qn(t,e){try{e(function(n){if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Xe();n&&typeof n.then=="function"?Qn(t,function(i,a){n instanceof A?n._then(i,a):n.then(i,a)}):(t._state=!0,t._value=n,Xn(t)),r&&qe()}},Ht.bind(null,t))}catch(n){Ht(t,n)}}function Ht(t,e){if(ot.push(e),t._state===null){var n=t._lib&&Xe();e=zt(e),t._state=!1,t._value=e,ne&&e!==null&&typeof e=="object"&&!e._promise&&br(function(){var r=rn(e,"stack");e._promise=t,se(e,"stack",{get:function(){return Ut?r&&(r.get?r.get.apply(e):r.value):t.stack}})}),Ur(t),Xn(t),n&&qe()}}function Xn(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)fn(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),we===0&&(++we,Ve(function(){--we===0&&hn()},[]))}function fn(t,e){if(t._state===null){t._listeners.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++we,Ve(Nr,[n,t,e])}function Nr(t,e,n){try{Vt=e;var r,i=e._value;e._state?r=t(i):(ot.length&&(ot=[]),r=t(i),ot.indexOf(i)===-1&&Lr(e)),n.resolve(r)}catch(a){n.reject(a)}finally{Vt=null,--we===0&&hn(),--n.psd.ref||n.psd.finalize()}}function qn(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i=t._value,a,u;i!=null?(a=i.name||"Error",u=i.message||i,r=Ft(i,0)):(a=i,u=""),e.push(a+(u?": "+u:"")+r)}return ne&&(r=Ft(t._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),t._prev&&qn(t._prev,e,n)),e}function Jn(t,e){var n=e?e._numPrev+1:0;n<Or&&(t._prev=e,t._numPrev=n)}function et(){Xe()&&qe()}function Xe(){var t=Lt;return Lt=!1,vt=!1,t}function qe(){var t,e,n;do for(;Me.length>0;)for(t=Me,Me=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(Me.length>0);Lt=!0,vt=!0}function hn(){var t=_e;_e=[],t.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var e=st.slice(0),n=e.length;n;)e[--n]()}function jr(t){function e(){t(),st.splice(st.indexOf(e),1)}st.push(e),++we,Ve(function(){--we===0&&hn()},[])}function Ur(t){_e.some(function(e){return e._value===t._value})||_e.push(t)}function Lr(t){for(var e=_e.length;e;)if(_e[--e]._value===t._value){_e.splice(e,1);return}}function ct(t){return new A(Le,!1,t)}function N(t,e){var n=S;return function(){var r=Xe(),i=S;try{return ye(n,!0),t.apply(this,arguments)}catch(a){e&&e(a)}finally{ye(i,!1),r&&qe()}}}var V={awaits:0,echoes:0,id:0},Vr=0,lt=[],St=0,pt=0,zr=0;function pe(t,e,n,r){var i=S,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++zr;var u=ke.env;a.env=ln?{Promise:A,PromiseProp:{value:A,configurable:!0,writable:!0},all:A.all,race:A.race,allSettled:A.allSettled,any:A.any,resolve:A.resolve,reject:A.reject,nthen:xn(u.nthen,a),gthen:xn(u.gthen,a)}:{},e&&H(a,e),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var o=Pe(a,t,n,r);return a.ref===0&&a.finalize(),o}function Re(){return V.id||(V.id=++Vr),++V.awaits,V.echoes+=Hn,V.id}function ce(){return V.awaits?(--V.awaits===0&&(V.id=0),V.echoes=V.awaits*Hn,!0):!1}(""+Yn).indexOf("[native code]")===-1&&(Re=ce=M);function yt(t){return V.echoes&&t&&t.constructor===ut?(Re(),t.then(function(e){return ce(),e},function(e){return ce(),U(e)})):t}function Wr(t){++pt,(!V.echoes||--V.echoes===0)&&(V.echoes=V.id=0),lt.push(S),ye(t,!0)}function Hr(){var t=lt[lt.length-1];lt.pop(),ye(t,!1)}function ye(t,e){var n=S;if((e?V.echoes&&(!St++||t!==S):St&&(!--St||t!==S))&&Zn(e?Wr.bind(null,t):Hr),t!==S&&(S=t,n===ke&&(ke.env=$n()),ln)){var r=ke.env.Promise,i=t.env;dt.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(F,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function $n(){var t=F.Promise;return ln?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(F,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:dt.then,gthen:t.prototype.then}:{}}function Pe(t,e,n,r,i){var a=S;try{return ye(t,!0),e(n,r,i)}finally{ye(a,!1)}}function Zn(t){Yn.call(Nt,t)}function mt(t,e,n,r){return typeof t!="function"?t:function(){var i=S;n&&Re(),ye(e,!0);try{return t.apply(this,arguments)}finally{ye(i,!1),r&&Zn(ce)}}}function xn(t,e){return function(n,r){return t.call(this,mt(n,e),mt(r,e))}}var En="unhandledrejection";function An(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,i={promise:e,reason:t};if(F.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(En,!0,!0),H(r,i)):F.CustomEvent&&(r=new CustomEvent(En,{detail:i}),H(r,i)),r&&F.dispatchEvent&&(dispatchEvent(r),!F.PromiseRejectionEvent&&F.onunhandledrejection))try{F.onunhandledrejection(r)}catch{}ne&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(t.stack||t))}catch{}}var U=A.reject;function Yt(t,e,n,r){if(!t.idbdb||!t._state.openComplete&&!S.letThrough&&!t._vip){if(t._state.openComplete)return U(new k.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return U(new k.DatabaseClosed);t.open().catch(M)}return t._state.dbReadyPromise.then(function(){return Yt(t,e,n,r)})}else{var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(a){return a.name===on.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return Yt(t,e,n,r)})):U(a)}return i._promise(e,function(a,u){return pe(function(){return S.trans=i,r(a,u,i)})}).then(function(a){return i._completion.then(function(){return a})})}}var Sn="3.2.5",be=String.fromCharCode(65535),Gt=-1/0,re="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",er="String expected.",Ne=[],Et=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Yr=Et,Gr=Et,tr=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)},At="__dbnames",Dt="readonly",Kt="readwrite";function Ee(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var nr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function tt(t){return typeof t=="string"&&!/\./.test(t)?function(e){return e[t]===void 0&&t in e&&(e=Ge(e),delete e[t]),e}:function(e){return e}}var Qr=function(){function t(){}return t.prototype._trans=function(e,n,r){var i=this._tx||S.trans,a=this.name;function u(s,c,h){if(!h.schema[a])throw new k.NotFound("Table "+a+" not part of transaction");return n(h.idbtrans,h)}var o=Xe();try{return i&&i.db===this.db?i===S.trans?i._promise(e,u,r):pe(function(){return i._promise(e,u,r)},{trans:i,transless:S.transless||S}):Yt(this.db,e,[this.name],u)}finally{o&&qe()}},t.prototype.get=function(e,n){var r=this;return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(a){return r.hook.reading.fire(a)})}).then(n)},t.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(z(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var n=j(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(l){if(l.compound&&n.every(function(w){return l.keyPath.indexOf(w)>=0})){for(var f=0;f<n.length;++f)if(n.indexOf(l.keyPath[f])===-1)return!1;return!0}return!1}).sort(function(l,f){return l.keyPath.length-f.keyPath.length})[0];if(r&&this.db._maxKey!==be){var i=r.keyPath.slice(0,n.length);return this.where(i).equals(i.map(function(l){return e[l]}))}!r&&ne&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a "+("compound index ["+n.join("+")+"]"));var a=this.schema.idxByName,u=this.db._deps.indexedDB;function o(l,f){try{return u.cmp(l,f)===0}catch{return!1}}var s=n.reduce(function(l,f){var w=l[0],y=l[1],d=a[f],v=e[f];return[w||d,w||!d?Ee(y,d&&d.multi?function(b){var g=oe(b,f);return z(g)&&g.some(function(m){return o(v,m)})}:function(b){return o(v,oe(b,f))}):y]},[null,null]),c=s[0],h=s[1];return c?this.where(c.name).equals(e[c.keyPath]).filter(h):r?this.filter(h):this.where(n).equals("")},t.prototype.filter=function(e){return this.toCollection().and(e)},t.prototype.count=function(e){return this.toCollection().count(e)},t.prototype.offset=function(e){return this.toCollection().offset(e)},t.prototype.limit=function(e){return this.toCollection().limit(e)},t.prototype.each=function(e){return this.toCollection().each(e)},t.prototype.toArray=function(e){return this.toCollection().toArray(e)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,z(e)?"["+e.join("+")+"]":e))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(e){this.schema.mappedClass=e;var n=function(r){if(!r)return r;var i=Object.create(e.prototype);for(var a in r)if(G(r,a))try{i[a]=r[a]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e},t.prototype.defineClass=function(){function e(n){H(this,n)}return this.mapToClass(e)},t.prototype.add=function(e,n){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=e;return u&&a&&(o=tt(u)(e)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"add",keys:n!=null?[n]:null,values:[o]})}).then(function(s){return s.numFailures?A.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{$(e,u,s)}catch{}return s})},t.prototype.update=function(e,n){if(typeof e=="object"&&!z(e)){var r=oe(e,this.schema.primKey.keyPath);if(r===void 0)return U(new k.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?j(n).forEach(function(i){$(e,i,n[i])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(e).modify(n)},t.prototype.put=function(e,n){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=e;return u&&a&&(o=tt(u)(e)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"put",values:[o],keys:n!=null?[n]:null})}).then(function(s){return s.numFailures?A.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{$(e,u,s)}catch{}return s})},t.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?A.reject(r.failures[0]):void 0})},t.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:nr})}).then(function(n){return n.numFailures?A.reject(n.failures[0]):void 0})},t.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(a){return n.hook.reading.fire(a)})})})},t.prototype.bulkAdd=function(e,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,h=s.keyPath;if(h&&a)throw new k.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new k.InvalidArgument("Arguments objects and keys must have the same length");var l=e.length,f=h&&c?e.map(tt(h)):e;return i.core.mutate({trans:o,type:"add",keys:a,values:f,wantResults:u}).then(function(w){var y=w.numFailures,d=w.results,v=w.lastResult,b=w.failures,g=u?d:v;if(y===0)return g;throw new Fe(i.name+".bulkAdd(): "+y+" of "+l+" operations failed",b)})})},t.prototype.bulkPut=function(e,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,h=s.keyPath;if(h&&a)throw new k.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new k.InvalidArgument("Arguments objects and keys must have the same length");var l=e.length,f=h&&c?e.map(tt(h)):e;return i.core.mutate({trans:o,type:"put",keys:a,values:f,wantResults:u}).then(function(w){var y=w.numFailures,d=w.results,v=w.lastResult,b=w.failures,g=u?d:v;if(y===0)return g;throw new Fe(i.name+".bulkPut(): "+y+" of "+l+" operations failed",b)})})},t.prototype.bulkDelete=function(e){var n=this,r=e.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:e})}).then(function(i){var a=i.numFailures,u=i.lastResult,o=i.failures;if(a===0)return u;throw new Fe(n.name+".bulkDelete(): "+a+" of "+r+" operations failed",o)})},t}();function Je(t){var e={},n=function(o,s){if(s){for(var c=arguments.length,h=new Array(c-1);--c;)h[c-1]=arguments[c];return e[o].subscribe.apply(null,h),t}else if(typeof o=="string")return e[o]};n.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return n;function a(o,s,c){if(typeof o=="object")return u(o);s||(s=Br),c||(c=M);var h={subscribers:[],fire:c,subscribe:function(l){h.subscribers.indexOf(l)===-1&&(h.subscribers.push(l),h.fire=s(h.fire,l))},unsubscribe:function(l){h.subscribers=h.subscribers.filter(function(f){return f!==l}),h.fire=h.subscribers.reduce(s,c)}};return e[o]=n[o]=h,h}function u(o){j(o).forEach(function(s){var c=o[s];if(z(c))a(s,o[s][0],o[s][1]);else if(c==="asap")var h=a(s,Qe,function(){for(var f=arguments.length,w=new Array(f);f--;)w[f]=arguments[f];h.subscribers.forEach(function(y){Mn(function(){y.apply(null,w)})})});else throw new k.InvalidArgument("Invalid event config")})}}function $e(t,e){return Te(e).from({prototype:t}),e}function Xr(t){return $e(Qr.prototype,function(n,r,i){this.db=t,this._tx=i,this.name=n,this.schema=r,this.hook=t._allTables[n]?t._allTables[n].hook:Je(null,{creating:[Ir,M],reading:[Tr,Qe],updating:[Pr,M],deleting:[Rr,M]})})}function Se(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function kt(t,e){t.filter=Ee(t.filter,e)}function Ct(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Ee(r(),e())}:e,t.justLimit=n&&!r}function qr(t,e){t.isMatch=Ee(t.isMatch,e)}function ft(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(!n)throw new k.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function Dn(t,e,n){var r=ft(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function nt(t,e,n,r){var i=t.replayFilter?Ee(t.filter,t.replayFilter()):t.filter;if(t.or){var a={},u=function(o,s,c){if(!i||i(s,c,function(f){return s.stop(f)},function(f){return s.fail(f)})){var h=s.primaryKey,l=""+h;l==="[object ArrayBuffer]"&&(l=""+new Uint8Array(h)),G(a,l)||(a[l]=!0,e(o,s,c))}};return Promise.all([t.or._iterate(u,n),Kn(Dn(t,r,n),t.algorithm,u,!t.keysOnly&&t.valueMapper)])}else return Kn(Dn(t,r,n),Ee(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Kn(t,e,n,r){var i=r?function(u,o,s){return n(r(u),o,s)}:n,a=N(i);return t.then(function(u){if(u)return u.start(function(){var o=function(){return u.continue()};(!e||e(u,function(s){return o=s},function(s){u.stop(s),o=M},function(s){u.fail(s),o=M}))&&a(u.value,u,function(s){return o=s}),o()})})}function W(t,e){try{var n=kn(t),r=kn(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return $r(Cn(t),Cn(e));case"Array":return Jr(t,e)}}catch{}return NaN}function Jr(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,a=0;a<i;++a){var u=W(t[a],e[a]);if(u!==0)return u}return n===r?0:n<r?-1:1}function $r(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,a=0;a<i;++a)if(t[a]!==e[a])return t[a]<e[a]?-1:1;return n===r?0:n<r?-1:1}function kn(t){var e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";var n=Ot(t);return n==="ArrayBuffer"?"binary":n}function Cn(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Zr=function(){function t(){}return t.prototype._read=function(e,n){var r=this._ctx;return r.error?r.table._trans(null,U.bind(null,r.error)):r.table._trans("readonly",e).then(n)},t.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,U.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},t.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=Ee(n.algorithm,e)},t.prototype._iterate=function(e,n){return nt(this._ctx,e,n,this._ctx.table.core)},t.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&H(r,e),n._ctx=r,n},t.prototype.raw=function(){return this._ctx.valueMapper=null,this},t.prototype.each=function(e){var n=this._ctx;return this._read(function(r){return nt(n,e,r,n.table.core)})},t.prototype.count=function(e){var n=this;return this._read(function(r){var i=n._ctx,a=i.table.core;if(Se(i,!0))return a.count({trans:r,query:{index:ft(i,a.schema),range:i.range}}).then(function(o){return Math.min(o,i.limit)});var u=0;return nt(i,function(){return++u,!1},r,a).then(function(){return u})}).then(e)},t.prototype.sortBy=function(e,n){var r=e.split(".").reverse(),i=r[0],a=r.length-1;function u(c,h){return h?u(c[r[h]],h-1):c[i]}var o=this._ctx.dir==="next"?1:-1;function s(c,h){var l=u(c,a),f=u(h,a);return l<f?-o:l>f?o:0}return this.toArray(function(c){return c.sort(s)}).then(n)},t.prototype.toArray=function(e){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&Se(i,!0)&&i.limit>0){var a=i.valueMapper,u=ft(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:u,range:i.range}}).then(function(s){var c=s.result;return a?c.map(a):c})}else{var o=[];return nt(i,function(s){return o.push(s)},r,i.table.core).then(function(){return o})}},e)},t.prototype.offset=function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,Se(n)?Ct(n,function(){var r=e;return function(i,a){return r===0?!0:r===1?(--r,!1):(a(function(){i.advance(r),r=0}),!1)}}):Ct(n,function(){var r=e;return function(){return--r<0}}),this)},t.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Ct(this._ctx,function(){var n=e;return function(r,i,a){return--n<=0&&i(a),n>=0}},!0),this},t.prototype.until=function(e,n){return kt(this._ctx,function(r,i,a){return e(r.value)?(i(a),n):!0}),this},t.prototype.first=function(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)},t.prototype.last=function(e){return this.reverse().first(e)},t.prototype.filter=function(e){return kt(this._ctx,function(n){return e(n.value)}),qr(this._ctx,e),this},t.prototype.and=function(e){return this.filter(e)},t.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},t.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},t.prototype.desc=function(){return this.reverse()},t.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})},t.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},t.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},t.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.key)}).then(function(){return r}).then(e)},t.prototype.primaryKeys=function(e){var n=this._ctx;if(n.dir==="next"&&Se(n,!0)&&n.limit>0)return this._read(function(i){var a=ft(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:a,range:n.range}})}).then(function(i){var a=i.result;return a}).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.primaryKey)}).then(function(){return r}).then(e)},t.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},t.prototype.firstKey=function(e){return this.limit(1).keys(function(n){return n[0]}).then(e)},t.prototype.lastKey=function(e){return this.reverse().firstKey(e)},t.prototype.distinct=function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return kt(this._ctx,function(i){var a=i.primaryKey.toString(),u=G(r,a);return r[a]=!0,!u}),this},t.prototype.modify=function(e){var n=this,r=this._ctx;return this._write(function(i){var a;if(typeof e=="function")a=e;else{var u=j(e),o=u.length;a=function(b){for(var g=!1,m=0;m<o;++m){var _=u[m],p=e[_];oe(b,_)!==p&&($(b,_,p),g=!0)}return g}}var s=r.table.core,c=s.schema.primaryKey,h=c.outbound,l=c.extractKey,f=n.db._options.modifyChunkSize||200,w=[],y=0,d=[],v=function(b,g){var m=g.failures,_=g.numFailures;y+=b-_;for(var p=0,x=j(m);p<x.length;p++){var D=x[p];w.push(m[D])}};return n.clone().primaryKeys().then(function(b){var g=function(m){var _=Math.min(f,b.length-m);return s.getMany({trans:i,keys:b.slice(m,m+_),cache:"immutable"}).then(function(p){for(var x=[],D=[],E=h?[]:null,K=[],C=0;C<_;++C){var B=p[C],O={value:Ge(B),primKey:b[m+C]};a.call(O,O.value,O)!==!1&&(O.value==null?K.push(b[m+C]):!h&&W(l(B),l(O.value))!==0?(K.push(b[m+C]),x.push(O.value)):(D.push(O.value),h&&E.push(b[m+C])))}var P=Se(r)&&r.limit===1/0&&(typeof e!="function"||e===Tt)&&{index:r.index,range:r.range};return Promise.resolve(x.length>0&&s.mutate({trans:i,type:"add",values:x}).then(function(L){for(var T in L.failures)K.splice(parseInt(T),1);v(x.length,L)})).then(function(){return(D.length>0||P&&typeof e=="object")&&s.mutate({trans:i,type:"put",keys:E,values:D,criteria:P,changeSpec:typeof e!="function"&&e}).then(function(L){return v(D.length,L)})}).then(function(){return(K.length>0||P&&e===Tt)&&s.mutate({trans:i,type:"delete",keys:K,criteria:P}).then(function(L){return v(K.length,L)})}).then(function(){return b.length>m+_&&g(m+f)})})};return g(0).then(function(){if(w.length>0)throw new ht("Error modifying one or more objects",w,y,d);return b.length})})})},t.prototype.delete=function(){var e=this._ctx,n=e.range;return Se(e)&&(e.isPrimKey&&!Gr||n.type===3)?this._write(function(r){var i=e.table.core.schema.primaryKey,a=n;return e.table.core.count({trans:r,query:{index:i,range:a}}).then(function(u){return e.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(function(o){var s=o.failures;o.lastResult,o.results;var c=o.numFailures;if(c)throw new ht("Could not delete some values",Object.keys(s).map(function(h){return s[h]}),u-c);return u-c})})}):this.modify(Tt)},t}(),Tt=function(t,e){return e.value=null};function ei(t){return $e(Zr.prototype,function(n,r){this.db=t;var i=nr,a=null;if(r)try{i=r()}catch(c){a=c}var u=n._ctx,o=u.table,s=o.hook.reading.fire;this._ctx={table:o,index:u.index,isPrimKey:!u.index||o.schema.primKey.keyPath&&u.index===o.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:a,or:u.or,valueMapper:s!==Qe?s:null}})}function ti(t,e){return t<e?-1:t===e?0:1}function ni(t,e){return t>e?-1:t===e?0:1}function Y(t,e,n){var r=t instanceof ir?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function De(t){return new t.Collection(t,function(){return rr("")}).limit(0)}function ri(t){return t==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function ii(t){return t==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function ai(t,e,n,r,i,a){for(var u=Math.min(t.length,r.length),o=-1,s=0;s<u;++s){var c=e[s];if(c!==r[s])return i(t[s],n[s])<0?t.substr(0,s)+n[s]+n.substr(s+1):i(t[s],r[s])<0?t.substr(0,s)+r[s]+n.substr(s+1):o>=0?t.substr(0,o)+e[o]+n.substr(o+1):null;i(t[s],c)<0&&(o=s)}return u<r.length&&a==="next"?t+n.substr(t.length):u<t.length&&a==="prev"?t.substr(0,n.length):o<0?null:t.substr(0,o)+r[o]+n.substr(o+1)}function rt(t,e,n,r){var i,a,u,o,s,c,h,l=n.length;if(!n.every(function(d){return typeof d=="string"}))return Y(t,er);function f(d){i=ri(d),a=ii(d),u=d==="next"?ti:ni;var v=n.map(function(b){return{lower:a(b),upper:i(b)}}).sort(function(b,g){return u(b.lower,g.lower)});o=v.map(function(b){return b.upper}),s=v.map(function(b){return b.lower}),c=d,h=d==="next"?"":r}f("next");var w=new t.Collection(t,function(){return he(o[0],s[l-1]+r)});w._ondirectionchange=function(d){f(d)};var y=0;return w._addAlgorithm(function(d,v,b){var g=d.key;if(typeof g!="string")return!1;var m=a(g);if(e(m,s,y))return!0;for(var _=null,p=y;p<l;++p){var x=ai(g,m,o[p],s[p],u,c);x===null&&_===null?y=p+1:(_===null||u(_,x)>0)&&(_=x)}return v(_!==null?function(){d.continue(_+h)}:b),!1}),w}function he(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function rr(t){return{type:1,lower:t,upper:t}}var ir=function(){function t(){}return Object.defineProperty(t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),t.prototype.between=function(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&!(r&&i)?De(this):new this.Collection(this,function(){return he(e,n,!r,!i)})}catch{return Y(this,re)}},t.prototype.equals=function(e){return e==null?Y(this,re):new this.Collection(this,function(){return rr(e)})},t.prototype.above=function(e){return e==null?Y(this,re):new this.Collection(this,function(){return he(e,void 0,!0)})},t.prototype.aboveOrEqual=function(e){return e==null?Y(this,re):new this.Collection(this,function(){return he(e,void 0,!1)})},t.prototype.below=function(e){return e==null?Y(this,re):new this.Collection(this,function(){return he(void 0,e,!1,!0)})},t.prototype.belowOrEqual=function(e){return e==null?Y(this,re):new this.Collection(this,function(){return he(void 0,e)})},t.prototype.startsWith=function(e){return typeof e!="string"?Y(this,er):this.between(e,e+be,!0,!0)},t.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):rt(this,function(n,r){return n.indexOf(r[0])===0},[e],be)},t.prototype.equalsIgnoreCase=function(e){return rt(this,function(n,r){return n===r[0]},[e],"")},t.prototype.anyOfIgnoreCase=function(){var e=ae.apply(Ke,arguments);return e.length===0?De(this):rt(this,function(n,r){return r.indexOf(n)!==-1},e,"")},t.prototype.startsWithAnyOfIgnoreCase=function(){var e=ae.apply(Ke,arguments);return e.length===0?De(this):rt(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},e,be)},t.prototype.anyOf=function(){var e=this,n=ae.apply(Ke,arguments),r=this._cmp;try{n.sort(r)}catch{return Y(this,re)}if(n.length===0)return De(this);var i=new this.Collection(this,function(){return he(n[0],n[n.length-1])});i._ondirectionchange=function(u){r=u==="next"?e._ascending:e._descending,n.sort(r)};var a=0;return i._addAlgorithm(function(u,o,s){for(var c=u.key;r(c,n[a])>0;)if(++a,a===n.length)return o(s),!1;return r(c,n[a])===0?!0:(o(function(){u.continue(n[a])}),!1)}),i},t.prototype.notEqual=function(e){return this.inAnyRange([[Gt,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},t.prototype.noneOf=function(){var e=ae.apply(Ke,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Y(this,re)}var n=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[Gt,i]]},null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},t.prototype.inAnyRange=function(e,n){var r=this,i=this._cmp,a=this._ascending,u=this._descending,o=this._min,s=this._max;if(e.length===0)return De(this);if(!e.every(function(p){return p[0]!==void 0&&p[1]!==void 0&&a(p[0],p[1])<=0}))return Y(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",k.InvalidArgument);var c=!n||n.includeLowers!==!1,h=n&&n.includeUppers===!0;function l(p,x){for(var D=0,E=p.length;D<E;++D){var K=p[D];if(i(x[0],K[1])<0&&i(x[1],K[0])>0){K[0]=o(K[0],x[0]),K[1]=s(K[1],x[1]);break}}return D===E&&p.push(x),p}var f=a;function w(p,x){return f(p[0],x[0])}var y;try{y=e.reduce(l,[]),y.sort(w)}catch{return Y(this,re)}var d=0,v=h?function(p){return a(p,y[d][1])>0}:function(p){return a(p,y[d][1])>=0},b=c?function(p){return u(p,y[d][0])>0}:function(p){return u(p,y[d][0])>=0};function g(p){return!v(p)&&!b(p)}var m=v,_=new this.Collection(this,function(){return he(y[0][0],y[y.length-1][1],!c,!h)});return _._ondirectionchange=function(p){p==="next"?(m=v,f=a):(m=b,f=u),y.sort(w)},_._addAlgorithm(function(p,x,D){for(var E=p.key;m(E);)if(++d,d===y.length)return x(D),!1;return g(E)?!0:(r._cmp(E,y[d][1])===0||r._cmp(E,y[d][0])===0||x(function(){f===a?p.continue(y[d][0]):p.continue(y[d][1])}),!1)}),_},t.prototype.startsWithAnyOf=function(){var e=ae.apply(Ke,arguments);return e.every(function(n){return typeof n=="string"})?e.length===0?De(this):this.inAnyRange(e.map(function(n){return[n,n+be]})):Y(this,"startsWithAnyOf() only works with strings")},t}();function ui(t){return $e(ir.prototype,function(n,r,i){this.db=t,this._ctx={table:n,index:r===":id"?null:r,or:i};var a=t._deps.indexedDB;if(!a)throw new k.MissingAPI;this._cmp=this._ascending=a.cmp.bind(a),this._descending=function(u,o){return a.cmp(o,u)},this._max=function(u,o){return a.cmp(u,o)>0?u:o},this._min=function(u,o){return a.cmp(u,o)<0?u:o},this._IDBKeyRange=t._deps.IDBKeyRange})}function te(t){return N(function(e){return ze(e),t(e.target.error),!1})}function ze(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var We="storagemutated",ve="x-storagemutated-1",me=Je(null,We),oi=function(){function t(){}return t.prototype._lock=function(){return Oe(!S.global),++this._reculock,this._reculock===1&&!S.global&&(S.lockOwnerFor=this),this},t.prototype._unlock=function(){if(Oe(!S.global),--this._reculock===0)for(S.global||(S.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Pe(e[1],e[0])}catch{}}return this},t.prototype._locked=function(){return this._reculock&&S.lockOwnerFor!==this},t.prototype.create=function(e){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(Oe(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new k.DatabaseClosed(i);case"MissingAPIError":throw new k.MissingAPI(i.message,i);default:throw new k.OpenFailed(i)}if(!this.active)throw new k.TransactionInactive;return Oe(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=N(function(a){ze(a),n._reject(e.error)}),e.onabort=N(function(a){ze(a),n.active&&n._reject(new k.Abort(e.error)),n.active=!1,n.on("abort").fire(a)}),e.oncomplete=N(function(){n.active=!1,n._resolve(),"mutatedParts"in e&&me.storagemutated.fire(e.mutatedParts)}),this},t.prototype._promise=function(e,n,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return U(new k.ReadOnly("Transaction is readonly"));if(!this.active)return U(new k.TransactionInactive);if(this._locked())return new A(function(u,o){i._blockedFuncs.push([function(){i._promise(e,n,r).then(u,o)},S])});if(r)return pe(function(){var u=new A(function(o,s){i._lock();var c=n(o,s,i);c&&c.then&&c.then(o,s)});return u.finally(function(){return i._unlock()}),u._lib=!0,u});var a=new A(function(u,o){var s=n(u,o,i);s&&s.then&&s.then(u,o)});return a._lib=!0,a},t.prototype._root=function(){return this.parent?this.parent._root():this},t.prototype.waitFor=function(e){var n=this._root(),r=A.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function u(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=u)})()}var a=n._waitingFor;return new A(function(u,o){r.then(function(s){return n._waitingQueue.push(N(u.bind(null,s)))},function(s){return n._waitingQueue.push(N(o.bind(null,s)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},t.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new k.Abort))},t.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(G(n,e))return n[e];var r=this.schema[e];if(!r)throw new k.NotFound("Table "+e+" not part of transaction");var i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i},t}();function si(t){return $e(oi.prototype,function(n,r,i,a,u){var o=this;this.db=t,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=a,this.idbtrans=null,this.on=Je(this,"complete","error","abort"),this.parent=u||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new A(function(s,c){o._resolve=s,o._reject=c}),this._completion.then(function(){o.active=!1,o.on.complete.fire()},function(s){var c=o.active;return o.active=!1,o.on.error.fire(s),o.parent?o.parent._reject(s):c&&o.idbtrans&&o.idbtrans.abort(),U(s)})})}function Qt(t,e,n,r,i,a,u){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:a,src:(n&&!u?"&":"")+(r?"*":"")+(i?"++":"")+ar(e)}}function ar(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function ur(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Fn(n,function(r){return[r.name,r]})}}function ci(t){return t.length===1?t[0]:t}var He=function(t){try{return t.only([[]]),He=function(){return[[]]},[[]]}catch{return He=function(){return be},be}};function Xt(t){return t==null?function(){}:typeof t=="string"?li(t):function(e){return oe(e,t)}}function li(t){var e=t.split(".");return e.length===1?function(n){return n[t]}:function(n){return oe(n,t)}}function Tn(t){return[].slice.call(t)}var fi=0;function je(t){return t==null?":id":typeof t=="string"?t:"["+t.join("+")+"]"}function hi(t,e,n){function r(l,f){var w=Tn(l.objectStoreNames);return{schema:{name:l.name,tables:w.map(function(y){return f.objectStore(y)}).map(function(y){var d=y.keyPath,v=y.autoIncrement,b=z(d),g=d==null,m={},_={name:y.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g,compound:b,keyPath:d,autoIncrement:v,unique:!0,extractKey:Xt(d)},indexes:Tn(y.indexNames).map(function(p){return y.index(p)}).map(function(p){var x=p.name,D=p.unique,E=p.multiEntry,K=p.keyPath,C=z(K),B={name:x,compound:C,keyPath:K,unique:D,multiEntry:E,extractKey:Xt(K)};return m[je(K)]=B,B}),getIndexByKeyPath:function(p){return m[je(p)]}};return m[":id"]=_.primaryKey,d!=null&&(m[je(d)]=_.primaryKey),_})},hasGetAll:w.length>0&&"getAll"in f.objectStore(w[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var f=l.lower,w=l.upper,y=l.lowerOpen,d=l.upperOpen,v=f===void 0?w===void 0?null:e.upperBound(w,!!d):w===void 0?e.lowerBound(f,!!y):e.bound(f,w,!!y,!!d);return v}function a(l){var f=l.name;function w(v){var b=v.trans,g=v.type,m=v.keys,_=v.values,p=v.range;return new Promise(function(x,D){x=N(x);var E=b.objectStore(f),K=E.keyPath==null,C=g==="put"||g==="add";if(!C&&g!=="delete"&&g!=="deleteRange")throw new Error("Invalid operation type: "+g);var B=(m||_||{length:1}).length;if(m&&_&&m.length!==_.length)throw new Error("Given keys array must have same length as given values array.");if(B===0)return x({numFailures:0,failures:{},results:[],lastResult:void 0});var O,P=[],L=[],T=0,Q=function(ee){++T,ze(ee)};if(g==="deleteRange"){if(p.type===4)return x({numFailures:T,failures:L,results:[],lastResult:void 0});p.type===3?P.push(O=E.clear()):P.push(O=E.delete(i(p)))}else{var q=C?K?[_,m]:[_,null]:[m,null],le=q[0],Z=q[1];if(C)for(var X=0;X<B;++X)P.push(O=Z&&Z[X]!==void 0?E[g](le[X],Z[X]):E[g](le[X])),O.onerror=Q;else for(var X=0;X<B;++X)P.push(O=E[g](le[X])),O.onerror=Q}var fe=function(ee){var Be=ee.target.result;P.forEach(function(J,Ze){return J.error!=null&&(L[Ze]=J.error)}),x({numFailures:T,failures:L,results:g==="delete"?m:P.map(function(J){return J.result}),lastResult:Be})};O.onerror=function(ee){Q(ee),fe(ee)},O.onsuccess=fe})}function y(v){var b=v.trans,g=v.values,m=v.query,_=v.reverse,p=v.unique;return new Promise(function(x,D){x=N(x);var E=m.index,K=m.range,C=b.objectStore(f),B=E.isPrimaryKey?C:C.index(E.name),O=_?p?"prevunique":"prev":p?"nextunique":"next",P=g||!("openKeyCursor"in B)?B.openCursor(i(K),O):B.openKeyCursor(i(K),O);P.onerror=te(D),P.onsuccess=N(function(L){var T=P.result;if(!T){x(null);return}T.___id=++fi,T.done=!1;var Q=T.continue.bind(T),q=T.continuePrimaryKey;q&&(q=q.bind(T));var le=T.advance.bind(T),Z=function(){throw new Error("Cursor not started")},X=function(){throw new Error("Cursor not stopped")};T.trans=b,T.stop=T.continue=T.continuePrimaryKey=T.advance=Z,T.fail=N(D),T.next=function(){var fe=this,ee=1;return this.start(function(){return ee--?fe.continue():fe.stop()}).then(function(){return fe})},T.start=function(fe){var ee=new Promise(function(J,Ze){J=N(J),P.onerror=te(Ze),T.fail=Ze,T.stop=function(dr){T.stop=T.continue=T.continuePrimaryKey=T.advance=X,J(dr)}}),Be=function(){if(P.result)try{fe()}catch(J){T.fail(J)}else T.done=!0,T.start=function(){throw new Error("Cursor behind last entry")},T.stop()};return P.onsuccess=N(function(J){P.onsuccess=Be,Be()}),T.continue=Q,T.continuePrimaryKey=q,T.advance=le,Be(),ee},x(T)},D)})}function d(v){return function(b){return new Promise(function(g,m){g=N(g);var _=b.trans,p=b.values,x=b.limit,D=b.query,E=x===1/0?void 0:x,K=D.index,C=D.range,B=_.objectStore(f),O=K.isPrimaryKey?B:B.index(K.name),P=i(C);if(x===0)return g({result:[]});if(v){var L=p?O.getAll(P,E):O.getAllKeys(P,E);L.onsuccess=function(le){return g({result:le.target.result})},L.onerror=te(m)}else{var T=0,Q=p||!("openKeyCursor"in O)?O.openCursor(P):O.openKeyCursor(P),q=[];Q.onsuccess=function(le){var Z=Q.result;if(!Z)return g({result:q});if(q.push(p?Z.value:Z.primaryKey),++T===x)return g({result:q});Z.continue()},Q.onerror=te(m)}})}}return{name:f,schema:l,mutate:w,getMany:function(v){var b=v.trans,g=v.keys;return new Promise(function(m,_){m=N(m);for(var p=b.objectStore(f),x=g.length,D=new Array(x),E=0,K=0,C,B=function(T){var Q=T.target;(D[Q._pos]=Q.result)!=null,++K===E&&m(D)},O=te(_),P=0;P<x;++P){var L=g[P];L!=null&&(C=p.get(g[P]),C._pos=P,C.onsuccess=B,C.onerror=O,++E)}E===0&&m(D)})},get:function(v){var b=v.trans,g=v.key;return new Promise(function(m,_){m=N(m);var p=b.objectStore(f),x=p.get(g);x.onsuccess=function(D){return m(D.target.result)},x.onerror=te(_)})},query:d(s),openCursor:y,count:function(v){var b=v.query,g=v.trans,m=b.index,_=b.range;return new Promise(function(p,x){var D=g.objectStore(f),E=m.isPrimaryKey?D:D.index(m.name),K=i(_),C=K?E.count(K):E.count();C.onsuccess=N(function(B){return p(B.target.result)}),C.onerror=te(x)})}}}var u=r(t,n),o=u.schema,s=u.hasGetAll,c=o.tables.map(function(l){return a(l)}),h={};return c.forEach(function(l){return h[l.name]=l}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(l){var f=h[l];if(!f)throw new Error("Table '"+l+"' not found");return h[l]},MIN_KEY:-1/0,MAX_KEY:He(e),schema:o}}function di(t,e){return e.reduce(function(n,r){var i=r.create;return I(I({},n),i(n))},t)}function vi(t,e,n,r){var i=n.IDBKeyRange;n.indexedDB;var a=di(hi(e,i,r),t.dbcore);return{dbcore:a}}function dn(t,e){var n=t._novip,r=e.db,i=vi(n._middlewares,r,n._deps,e);n.core=i.dbcore,n.tables.forEach(function(a){var u=a.name;n.core.schema.tables.some(function(o){return o.name===u})&&(a.core=n.core.table(u),n[u]instanceof n.Table&&(n[u].core=a.core))})}function gt(t,e,n,r){var i=t._novip;n.forEach(function(a){var u=r[a];e.forEach(function(o){var s=rn(o,a);(!s||"value"in s&&s.value===void 0)&&(o===i.Transaction.prototype||o instanceof i.Transaction?se(o,a,{get:function(){return this.table(a)},set:function(c){Bn(this,a,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):o[a]=new i.Table(a,u))})})}function qt(t,e){var n=t._novip;e.forEach(function(r){for(var i in r)r[i]instanceof n.Table&&delete r[i]})}function pi(t,e){return t._cfg.version-e._cfg.version}function yi(t,e,n,r){var i=t._dbSchema,a=t._createTransaction("readwrite",t._storeNames,i);a.create(n),a._completion.catch(r);var u=a._reject.bind(a),o=S.transless||S;pe(function(){S.trans=a,S.transless=o,e===0?(j(i).forEach(function(s){vn(n,s,i[s].primKey,i[s].indexes)}),dn(t,n),A.follow(function(){return t.on.populate.fire(a)}).catch(u)):mi(t,e,a,n).catch(u)})}function mi(t,e,n,r){var i=t._novip,a=[],u=i._versions,o=i._dbSchema=pn(i,i.idbdb,r),s=!1,c=u.filter(function(l){return l._cfg.version>=e});c.forEach(function(l){a.push(function(){var f=o,w=l._cfg.dbschema;$t(i,f,r),$t(i,w,r),o=i._dbSchema=w;var y=or(f,w);y.add.forEach(function(_){vn(r,_[0],_[1].primKey,_[1].indexes)}),y.change.forEach(function(_){if(_.recreate)throw new k.Upgrade("Not yet support for changing primary key");var p=r.objectStore(_.name);_.add.forEach(function(x){return Jt(p,x)}),_.change.forEach(function(x){p.deleteIndex(x.name),Jt(p,x)}),_.del.forEach(function(x){return p.deleteIndex(x)})});var d=l._cfg.contentUpgrade;if(d&&l._cfg.version>e){dn(i,r),n._memoizedTables={},s=!0;var v=Nn(w);y.del.forEach(function(_){v[_]=f[_]}),qt(i,[i.Transaction.prototype]),gt(i,[i.Transaction.prototype],j(v),v),n.schema=v;var b=an(d);b&&Re();var g,m=A.follow(function(){if(g=d(n),g&&b){var _=ce.bind(null,null);g.then(_,_)}});return g&&typeof g.then=="function"?A.resolve(g):m.then(function(){return g})}}),a.push(function(f){if(!s||!Yr){var w=l._cfg.dbschema;bi(w,f)}qt(i,[i.Transaction.prototype]),gt(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),n.schema=i._dbSchema})});function h(){return a.length?A.resolve(a.shift()(n.idbtrans)).then(h):A.resolve()}return h().then(function(){gi(o,r)})}function or(t,e){var n={del:[],add:[],change:[]},r;for(r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],a=e[r];if(!i)n.add.push([r,a]);else{var u={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto&&!Et)u.recreate=!0,n.change.push(u);else{var o=i.idxByName,s=a.idxByName,c=void 0;for(c in o)s[c]||u.del.push(c);for(c in s){var h=o[c],l=s[c];h?h.src!==l.src&&u.change.push(l):u.add.push(l)}(u.del.length>0||u.add.length>0||u.change.length>0)&&n.change.push(u)}}}return n}function vn(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return Jt(i,a)}),i}function gi(t,e){j(t).forEach(function(n){e.db.objectStoreNames.contains(n)||vn(e,n,t[n].primKey,t[n].indexes)})}function bi(t,e){[].slice.call(e.db.objectStoreNames).forEach(function(n){return t[n]==null&&e.db.deleteObjectStore(n)})}function Jt(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function pn(t,e,n){var r={},i=wt(e.objectStoreNames,0);return i.forEach(function(a){for(var u=n.objectStore(a),o=u.keyPath,s=Qt(ar(o),o||"",!1,!1,!!u.autoIncrement,o&&typeof o!="string",!0),c=[],h=0;h<u.indexNames.length;++h){var l=u.index(u.indexNames[h]);o=l.keyPath;var f=Qt(l.name,o,!!l.unique,!!l.multiEntry,!1,o&&typeof o!="string",!1);c.push(f)}r[a]=ur(a,s,c)}),r}function _i(t,e,n){var r=t._novip;r.verno=e.version/10;var i=r._dbSchema=pn(r,e,n);r._storeNames=wt(e.objectStoreNames,0),gt(r,[r._allTables],j(i),i)}function wi(t,e){var n=pn(t,t.idbdb,e),r=or(n,t._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function $t(t,e,n){for(var r=t._novip,i=n.db.objectStoreNames,a=0;a<i.length;++a){var u=i[a],o=n.objectStore(u);r._hasGetAll="getAll"in o;for(var s=0;s<o.indexNames.length;++s){var c=o.indexNames[s],h=o.index(c).keyPath,l=typeof h=="string"?h:"["+wt(h).join("+")+"]";if(e[u]){var f=e[u].idxByName[l];f&&(f.name=c,delete e[u].idxByName[l],e[u].idxByName[c]=f)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&F.WorkerGlobalScope&&F instanceof F.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function xi(t){return t.split(",").map(function(e,n){e=e.trim();var r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Qt(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),z(i),n===0)})}var Ei=function(){function t(){}return t.prototype._parseStoresSpec=function(e,n){j(e).forEach(function(r){if(e[r]!==null){var i=xi(e[r]),a=i.shift();if(a.multi)throw new k.Schema("Primary key cannot be multi-valued");i.forEach(function(u){if(u.auto)throw new k.Schema("Only primary key can be marked as autoIncrement (++)");if(!u.keyPath)throw new k.Schema("Index must have a name and cannot be an empty string")}),n[r]=ur(r,a,i)}})},t.prototype.stores=function(e){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?H(this._cfg.storesSource,e):e;var r=n._versions,i={},a={};return r.forEach(function(u){H(i,u._cfg.storesSource),a=u._cfg.dbschema={},u._parseStoresSpec(i,a)}),n._dbSchema=a,qt(n,[n._allTables,n,n.Transaction.prototype]),gt(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],j(a),a),n._storeNames=j(a),this},t.prototype.upgrade=function(e){return this._cfg.contentUpgrade=sn(this._cfg.contentUpgrade||M,e),this},t}();function Ai(t){return $e(Ei.prototype,function(n){this.db=t,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function yn(t,e){var n=t._dbNamesDB;return n||(n=t._dbNamesDB=new _n(At,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function mn(t){return t&&typeof t.databases=="function"}function Si(t){var e=t.indexedDB,n=t.IDBKeyRange;return mn(e)?Promise.resolve(e.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==At})}):yn(e,n).toCollection().primaryKeys()}function Di(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!mn(n)&&e!==At&&yn(n,r).put({name:e}).catch(M)}function Ki(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!mn(n)&&e!==At&&yn(n,r).delete(e).catch(M)}function Zt(t){return pe(function(){return S.letThrough=!0,t()})}function ki(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function Ci(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?U(e.dbOpenError):t});ne&&(e.openCanceller._stackHolder=Ae()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new k.DatabaseClosed("db.open() was cancelled")}var a=e.dbReadyResolve,u=null,o=!1,s=function(){return new A(function(c,h){if(i(),!n)throw new k.MissingAPI;var l=t.name,f=e.autoSchema?n.open(l):n.open(l,Math.round(t.verno*10));if(!f)throw new k.MissingAPI;f.onerror=te(h),f.onblocked=N(t._fireOnBlocked),f.onupgradeneeded=N(function(w){if(u=f.transaction,e.autoSchema&&!t._options.allowEmptyDB){f.onerror=ze,u.abort(),f.result.close();var y=n.deleteDatabase(l);y.onsuccess=y.onerror=N(function(){h(new k.NoSuchDatabase("Database "+l+" doesnt exist"))})}else{u.onerror=te(h);var d=w.oldVersion>Math.pow(2,62)?0:w.oldVersion;o=d<1,t._novip.idbdb=f.result,yi(t,d/10,u,h)}},h),f.onsuccess=N(function(){u=null;var w=t._novip.idbdb=f.result,y=wt(w.objectStoreNames);if(y.length>0)try{var d=w.transaction(ci(y),"readonly");e.autoSchema?_i(t,w,d):($t(t,t._dbSchema,d),wi(t,d)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),dn(t,d)}catch{}Ne.push(t),w.onversionchange=N(function(v){e.vcFired=!0,t.on("versionchange").fire(v)}),w.onclose=N(function(v){t.on("close").fire(v)}),o&&Di(t._deps,l),c()},h)}).catch(function(c){return c&&c.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),s()):A.reject(c)})};return A.race([r,(typeof navigator=="undefined"?A.resolve():ki()).then(s)]).then(function(){return i(),e.onReadyBeingFired=[],A.resolve(Zt(function(){return t.on.ready.fire(t.vip)})).then(function c(){if(e.onReadyBeingFired.length>0){var h=e.onReadyBeingFired.reduce(sn,M);return e.onReadyBeingFired=[],A.resolve(Zt(function(){return h(t.vip)})).then(c)}})}).finally(function(){e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(function(){return t}).catch(function(c){e.dbOpenError=c;try{u&&u.abort()}catch{}return r===e.openCanceller&&t._close(),U(c)}).finally(function(){e.openComplete=!0,a()})}function en(t){var e=function(u){return t.next(u)},n=function(u){return t.throw(u)},r=a(e),i=a(n);function a(u){return function(o){var s=u(o),c=s.value;return s.done?c:!c||typeof c.then!="function"?z(c)?Promise.all(c).then(r,i):r(c):c.then(r,i)}}return a(e)()}function Ti(t,e,n){var r=arguments.length;if(r<2)throw new k.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var a=jn(i);return[t,a,n]}function sr(t,e,n,r,i){return A.resolve().then(function(){var a=S.transless||S,u=t._createTransaction(e,n,t._dbSchema,r),o={trans:u,transless:a};if(r)u.idbtrans=r.idbtrans;else try{u.create(),t._state.PR1398_maxLoop=3}catch(l){return l.name===on.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return sr(t,e,n,null,i)})):U(l)}var s=an(i);s&&Re();var c,h=A.follow(function(){if(c=i.call(u,u),c)if(s){var l=ce.bind(null,null);c.then(l,l)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=en(c))},o);return(c&&typeof c.then=="function"?A.resolve(c).then(function(l){return u.active?l:U(new k.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):h.then(function(){return c})).then(function(l){return r&&u._resolve(),u._completion.then(function(){return l})}).catch(function(l){return u._reject(l),U(l)})})}function it(t,e,n){for(var r=z(t)?t.slice():[t],i=0;i<n;++i)r.push(e);return r}function Ii(t){return I(I({},t),{table:function(e){var n=t.table(e),r=n.schema,i={},a=[];function u(d,v,b){var g=je(d),m=i[g]=i[g]||[],_=d==null?0:typeof d=="string"?1:d.length,p=v>0,x=I(I({},b),{isVirtual:p,keyTail:v,keyLength:_,extractKey:Xt(d),unique:!p&&b.unique});if(m.push(x),x.isPrimaryKey||a.push(x),_>1){var D=_===2?d[0]:d.slice(0,_-1);u(D,v+1,b)}return m.sort(function(E,K){return E.keyTail-K.keyTail}),x}var o=u(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[o];for(var s=0,c=r.indexes;s<c.length;s++){var h=c[s];u(h.keyPath,0,h)}function l(d){var v=i[je(d)];return v&&v[0]}function f(d,v){return{type:d.type===1?2:d.type,lower:it(d.lower,d.lowerOpen?t.MAX_KEY:t.MIN_KEY,v),lowerOpen:!0,upper:it(d.upper,d.upperOpen?t.MIN_KEY:t.MAX_KEY,v),upperOpen:!0}}function w(d){var v=d.query.index;return v.isVirtual?I(I({},d),{query:{index:v,range:f(d.query.range,v.keyTail)}}):d}var y=I(I({},n),{schema:I(I({},r),{primaryKey:o,indexes:a,getIndexByKeyPath:l}),count:function(d){return n.count(w(d))},query:function(d){return n.query(w(d))},openCursor:function(d){var v=d.query.index,b=v.keyTail,g=v.isVirtual,m=v.keyLength;if(!g)return n.openCursor(d);function _(p){function x(E){E!=null?p.continue(it(E,d.reverse?t.MAX_KEY:t.MIN_KEY,b)):d.unique?p.continue(p.key.slice(0,m).concat(d.reverse?t.MIN_KEY:t.MAX_KEY,b)):p.continue()}var D=Object.create(p,{continue:{value:x},continuePrimaryKey:{value:function(E,K){p.continuePrimaryKey(it(E,t.MAX_KEY,b),K)}},primaryKey:{get:function(){return p.primaryKey}},key:{get:function(){var E=p.key;return m===1?E[0]:E.slice(0,m)}},value:{get:function(){return p.value}}});return D}return n.openCursor(w(d)).then(function(p){return p&&_(p)})}});return y}})}var Ri={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Ii};function gn(t,e,n,r){return n=n||{},r=r||"",j(t).forEach(function(i){if(!G(e,i))n[r+i]=void 0;else{var a=t[i],u=e[i];if(typeof a=="object"&&typeof u=="object"&&a&&u){var o=Ot(a),s=Ot(u);o!==s?n[r+i]=e[i]:o==="Object"?gn(a,u,n,r+i+"."):a!==u&&(n[r+i]=e[i])}else a!==u&&(n[r+i]=e[i])}}),j(e).forEach(function(i){G(t,i)||(n[r+i]=e[i])}),n}function Pi(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Bi={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return I(I({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey,i=I(I({},n),{mutate:function(a){var u=S.trans,o=u.table(e).hook,s=o.deleting,c=o.creating,h=o.updating;switch(a.type){case"add":if(c.fire===M)break;return u._promise("readwrite",function(){return l(a)},!0);case"put":if(c.fire===M&&h.fire===M)break;return u._promise("readwrite",function(){return l(a)},!0);case"delete":if(s.fire===M)break;return u._promise("readwrite",function(){return l(a)},!0);case"deleteRange":if(s.fire===M)break;return u._promise("readwrite",function(){return f(a)},!0)}return n.mutate(a);function l(y){var d=S.trans,v=y.keys||Pi(r,y);if(!v)throw new Error("Keys missing");return y=y.type==="add"||y.type==="put"?I(I({},y),{keys:v}):I({},y),y.type!=="delete"&&(y.values=Pt([],y.values,!0)),y.keys&&(y.keys=Pt([],y.keys,!0)),Oi(n,y,v).then(function(b){var g=v.map(function(m,_){var p=b[_],x={onerror:null,onsuccess:null};if(y.type==="delete")s.fire.call(x,m,p,d);else if(y.type==="add"||p===void 0){var D=c.fire.call(x,m,y.values[_],d);m==null&&D!=null&&(m=D,y.keys[_]=m,r.outbound||$(y.values[_],r.keyPath,m))}else{var E=gn(p,y.values[_]),K=h.fire.call(x,E,m,p,d);if(K){var C=y.values[_];Object.keys(K).forEach(function(B){G(C,B)?C[B]=K[B]:$(C,B,K[B])})}}return x});return n.mutate(y).then(function(m){for(var _=m.failures,p=m.results,x=m.numFailures,D=m.lastResult,E=0;E<v.length;++E){var K=p?p[E]:v[E],C=g[E];K==null?C.onerror&&C.onerror(_[E]):C.onsuccess&&C.onsuccess(y.type==="put"&&b[E]?y.values[E]:K)}return{failures:_,results:p,numFailures:x,lastResult:D}}).catch(function(m){return g.forEach(function(_){return _.onerror&&_.onerror(m)}),Promise.reject(m)})})}function f(y){return w(y.trans,y.range,1e4)}function w(y,d,v){return n.query({trans:y,values:!1,query:{index:r,range:d},limit:v}).then(function(b){var g=b.result;return l({type:"delete",keys:g,trans:y}).then(function(m){return m.numFailures>0?Promise.reject(m.failures[0]):g.length<v?{failures:[],numFailures:0,lastResult:void 0}:w(y,I(I({},d),{lower:g[g.length-1],lowerOpen:!0}),v)})})}}});return i}})}};function Oi(t,e,n){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}function cr(t,e,n){try{if(!e||e.keys.length<t.length)return null;for(var r=[],i=0,a=0;i<e.keys.length&&a<t.length;++i)W(e.keys[i],t[a])===0&&(r.push(n?Ge(e.values[i]):e.values[i]),++a);return r.length===t.length?r:null}catch{return null}}var Mi={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var n=t.table(e);return I(I({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=cr(r.keys,r.trans._cache,r.cache==="clone");return i?A.resolve(i):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Ge(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}},It;function bn(t){return!("from"in t)}var ie=function(t,e){if(this)H(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{var n=new ie;return t&&"d"in t&&H(n,t),n}};Ce(ie.prototype,(It={add:function(t){return bt(this,t),this},addKey:function(t){return Ye(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(n){return Ye(e,n,n)}),this}},It[Mt]=function(){return tn(this)},It));function Ye(t,e,n){var r=W(e,n);if(!isNaN(r)){if(r>0)throw RangeError();if(bn(t))return H(t,{from:e,to:n,d:1});var i=t.l,a=t.r;if(W(n,t.from)<0)return i?Ye(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},In(t);if(W(e,t.to)>0)return a?Ye(a,e,n):t.r={from:e,to:n,d:1,l:null,r:null},In(t);W(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),W(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);var u=!t.r;i&&!t.l&&bt(t,i),a&&u&&bt(t,a)}}function bt(t,e){function n(r,i){var a=i.from,u=i.to,o=i.l,s=i.r;Ye(r,a,u),o&&n(r,o),s&&n(r,s)}bn(e)||n(t,e)}function Fi(t,e){var n=tn(e),r=n.next();if(r.done)return!1;for(var i=r.value,a=tn(t),u=a.next(i.from),o=u.value;!r.done&&!u.done;){if(W(o.from,i.to)<=0&&W(o.to,i.from)>=0)return!0;W(i.from,o.from)<0?i=(r=n.next(o.from)).value:o=(u=a.next(i.from)).value}return!1}function tn(t){var e=bn(t)?null:{s:0,n:t};return{next:function(n){for(var r=arguments.length>0;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&W(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||W(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function In(t){var e,n,r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a=i==="r"?"l":"r",u=I({},t),o=t[i];t.from=o.from,t.to=o.to,t[i]=o[i],u[i]=o[a],t[a]=u,u.d=Rn(u)}t.d=Rn(t)}function Rn(t){var e=t.r,n=t.l;return(e?n?Math.max(e.d,n.d):e.d:n?n.d:0)+1}var Ni={stack:"dbcore",level:0,create:function(t){var e=t.schema.name,n=new ie(t.MIN_KEY,t.MAX_KEY);return I(I({},t),{table:function(r){var i=t.table(r),a=i.schema,u=a.primaryKey,o=u.extractKey,s=u.outbound,c=I(I({},i),{mutate:function(f){var w=f.trans,y=w.mutatedParts||(w.mutatedParts={}),d=function(D){var E="idb://"+e+"/"+r+"/"+D;return y[E]||(y[E]=new ie)},v=d(""),b=d(":dels"),g=f.type,m=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[],_=m[0],p=m[1],x=f.trans._cache;return i.mutate(f).then(function(D){if(z(_)){g!=="delete"&&(_=D.results),v.addKeys(_);var E=cr(_,x);!E&&g!=="add"&&b.addKeys(_),(E||p)&&ji(d,a,E,p)}else if(_){var K={from:_.lower,to:_.upper};b.add(K),v.add(K)}else v.add(n),b.add(n),a.indexes.forEach(function(C){return d(C.name).add(n)});return D})}}),h=function(f){var w,y,d=f.query,v=d.index,b=d.range;return[v,new ie((w=b.lower)!==null&&w!==void 0?w:t.MIN_KEY,(y=b.upper)!==null&&y!==void 0?y:t.MAX_KEY)]},l={get:function(f){return[u,new ie(f.key)]},getMany:function(f){return[u,new ie().addKeys(f.keys)]},count:h,query:h,openCursor:h};return j(l).forEach(function(f){c[f]=function(w){var y=S.subscr;if(y){var d=function(x){var D="idb://"+e+"/"+r+"/"+x;return y[D]||(y[D]=new ie)},v=d(""),b=d(":dels"),g=l[f](w),m=g[0],_=g[1];if(d(m.name||"").add(_),!m.isPrimaryKey)if(f==="count")b.add(n);else{var p=f==="query"&&s&&w.values&&i.query(I(I({},w),{values:!1}));return i[f].apply(this,arguments).then(function(x){if(f==="query"){if(s&&w.values)return p.then(function(C){var B=C.result;return v.addKeys(B),x});var D=w.values?x.result.map(o):x.result;w.values?v.addKeys(D):b.addKeys(D)}else if(f==="openCursor"){var E=x,K=w.values;return E&&Object.create(E,{key:{get:function(){return b.addKey(E.primaryKey),E.key}},primaryKey:{get:function(){var C=E.primaryKey;return b.addKey(C),C}},value:{get:function(){return K&&v.addKey(E.primaryKey),E.value}}})}return x})}}return i[f].apply(this,arguments)}}),c}})}};function ji(t,e,n,r){function i(a){var u=t(a.name||"");function o(c){return c!=null?a.extractKey(c):null}var s=function(c){return a.multiEntry&&z(c)?c.forEach(function(h){return u.addKey(h)}):u.addKey(c)};(n||r).forEach(function(c,h){var l=n&&o(n[h]),f=r&&o(r[h]);W(l,f)!==0&&(l!=null&&s(l),f!=null&&s(f))})}e.indexes.forEach(i)}var _n=function(){function t(e,n){var r=this;this._middlewares={},this.verno=0;var i=t.dependencies;this._options=n=I({addons:t.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var a=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:M,dbReadyPromise:null,cancelOpen:M,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};u.dbReadyPromise=new A(function(o){u.dbReadyResolve=o}),u.openCanceller=new A(function(o,s){u.cancelOpen=s}),this._state=u,this.name=e,this.on=Je(this,"populate","blocked","versionchange","close",{ready:[sn,M]}),this.on.ready.subscribe=On(this.on.ready.subscribe,function(o){return function(s,c){t.vip(function(){var h=r._state;if(h.openComplete)h.dbOpenError||A.resolve().then(s),c&&o(s);else if(h.onReadyBeingFired)h.onReadyBeingFired.push(s),c&&o(s);else{o(s);var l=r;c||o(function f(){l.on.ready.unsubscribe(s),l.on.ready.unsubscribe(f)})}})}}),this.Collection=ei(this),this.Table=Xr(this),this.Transaction=si(this),this.Version=Ai(this),this.WhereClause=ui(this),this.on("versionchange",function(o){o.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(o){!o.newVersion||o.newVersion<o.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+o.oldVersion/10)}),this._maxKey=He(n.IDBKeyRange),this._createTransaction=function(o,s,c,h){return new r.Transaction(o,s,c,r._options.chromeTransactionDurability,h)},this._fireOnBlocked=function(o){r.on("blocked").fire(o),Ne.filter(function(s){return s.name===r.name&&s!==r&&!s._state.vcFired}).map(function(s){return s.on("versionchange").fire(o)})},this.use(Ri),this.use(Bi),this.use(Ni),this.use(Mi),this.vip=Object.create(this,{_vip:{value:!0}}),a.forEach(function(o){return o(r)})}return t.prototype.version=function(e){if(isNaN(e)||e<.1)throw new k.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new k.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,r=n.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),n.push(r),n.sort(pi),r.stores({}),this._state.autoSchema=!1,r)},t.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||S.letThrough||this._vip)?e():new A(function(r,i){if(n._state.openComplete)return i(new k.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen){i(new k.DatabaseClosed);return}n.open().catch(M)}n._state.dbReadyPromise.then(r,i)}).then(e)},t.prototype.use=function(e){var n=e.stack,r=e.create,i=e.level,a=e.name;a&&this.unuse({stack:n,name:a});var u=this._middlewares[n]||(this._middlewares[n]=[]);return u.push({stack:n,create:r,level:i==null?10:i,name:a}),u.sort(function(o,s){return o.level-s.level}),this},t.prototype.unuse=function(e){var n=e.stack,r=e.name,i=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(a){return i?a.create!==i:r?a.name!==r:!1})),this},t.prototype.open=function(){return Ci(this)},t.prototype._close=function(){var e=this._state,n=Ne.indexOf(this);if(n>=0&&Ne.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new A(function(r){e.dbReadyResolve=r}),e.openCanceller=new A(function(r,i){e.cancelOpen=i})},t.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new k.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},t.prototype.delete=function(){var e=this,n=arguments.length>0,r=this._state;return new A(function(i,a){var u=function(){e.close();var o=e._deps.indexedDB.deleteDatabase(e.name);o.onsuccess=N(function(){Ki(e._deps,e.name),i()}),o.onerror=te(a),o.onblocked=e._fireOnBlocked};if(n)throw new k.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(u):u()})},t.prototype.backendDB=function(){return this.idbdb},t.prototype.isOpen=function(){return this.idbdb!==null},t.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},t.prototype.hasFailed=function(){return this._state.dbOpenError!==null},t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(t.prototype,"tables",{get:function(){var e=this;return j(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!1,configurable:!0}),t.prototype.transaction=function(){var e=Ti.apply(this,arguments);return this._transaction.apply(this,e)},t.prototype._transaction=function(e,n,r){var i=this,a=S.trans;(!a||a.db!==this||e.indexOf("!")!==-1)&&(a=null);var u=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var o,s;try{if(s=n.map(function(h){var l=h instanceof i.Table?h.name:h;if(typeof l!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return l}),e=="r"||e===Dt)o=Dt;else if(e=="rw"||e==Kt)o=Kt;else throw new k.InvalidArgument("Invalid transaction mode: "+e);if(a){if(a.mode===Dt&&o===Kt)if(u)a=null;else throw new k.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a&&s.forEach(function(h){if(a&&a.storeNames.indexOf(h)===-1)if(u)a=null;else throw new k.SubTransaction("Table "+h+" not included in parent transaction.")}),u&&a&&!a.active&&(a=null)}}catch(h){return a?a._promise(null,function(l,f){f(h)}):U(h)}var c=sr.bind(null,this,o,s,a,r);return a?a._promise(o,c,"lock"):S.trans?Pe(S.transless,function(){return i._whenReady(c)}):this._whenReady(c)},t.prototype.table=function(e){if(!G(this._allTables,e))throw new k.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},t}(),Ui=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",Li=function(){function t(e){this._subscribe=e}return t.prototype.subscribe=function(e,n,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:n,complete:r}:e)},t.prototype[Ui]=function(){return this},t}();function lr(t,e){return j(e).forEach(function(n){var r=t[n]||(t[n]=new ie);bt(r,e[n])}),t}function Vi(t){var e=!1,n=void 0,r=new Li(function(i){var a=an(t);function u(v){a&&Re();var b=function(){return pe(t,{subscr:v,trans:null})},g=S.trans?Pe(S.transless,b):b();return a&&g.then(ce,ce),g}var o=!1,s={},c={},h={get closed(){return o},unsubscribe:function(){o=!0,me.storagemutated.unsubscribe(y)}};i.start&&i.start(h);var l=!1,f=!1;function w(){return j(c).some(function(v){return s[v]&&Fi(s[v],c[v])})}var y=function(v){lr(s,v),w()&&d()},d=function(){if(!(l||o)){s={};var v={},b=u(v);f||(me(We,y),f=!0),l=!0,Promise.resolve(b).then(function(g){e=!0,n=g,l=!1,!o&&(w()?d():(s={},c=v,i.next&&i.next(g)))},function(g){l=!1,e=!1,i.error&&i.error(g),h.unsubscribe()})}};return d(),h});return r.hasValue=function(){return e},r.getValue=function(){return n},r}var nn;try{nn={indexedDB:F.indexedDB||F.mozIndexedDB||F.webkitIndexedDB||F.msIndexedDB,IDBKeyRange:F.IDBKeyRange||F.webkitIDBKeyRange}}catch{nn={indexedDB:null,IDBKeyRange:null}}var ge=_n;Ce(ge,I(I({},xt),{delete:function(t){var e=new ge(t,{addons:[]});return e.delete()},exists:function(t){return new ge(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return Si(ge.dependencies).then(t)}catch{return U(new k.MissingAPI)}},defineClass:function(){function t(e){H(this,e)}return t},ignoreTransaction:function(t){return S.trans?Pe(S.transless,t):t()},vip:Zt,async:function(t){return function(){try{var e=en(t.apply(this,arguments));return!e||typeof e.then!="function"?A.resolve(e):e}catch(n){return U(n)}}},spawn:function(t,e,n){try{var r=en(t.apply(n,e||[]));return!r||typeof r.then!="function"?A.resolve(r):r}catch(i){return U(i)}},currentTransaction:{get:function(){return S.trans||null}},waitFor:function(t,e){var n=A.resolve(typeof t=="function"?ge.ignoreTransaction(t):t).timeout(e||6e4);return S.trans?S.trans.waitFor(n):n},Promise:A,debug:{get:function(){return ne},set:function(t){Ln(t,t==="dexie"?function(){return!0}:tr)}},derive:Te,extend:H,props:Ce,override:On,Events:Je,on:me,liveQuery:Vi,extendObservabilitySet:lr,getByKeyPath:oe,setByKeyPath:$,delByKeyPath:_r,shallowClone:Nn,deepClone:Ge,getObjectDiff:gn,cmp:W,asap:Mn,minKey:Gt,addons:[],connections:Ne,errnames:on,dependencies:nn,semVer:Sn,version:Sn.split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,n*2)})}));ge.maxKey=He(ge.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(me(We,function(t){if(!ue){var e;Et?(e=document.createEvent("CustomEvent"),e.initCustomEvent(ve,!0,!0,t)):e=new CustomEvent(ve,{detail:t}),ue=!0,dispatchEvent(e),ue=!1}}),addEventListener(ve,function(t){var e=t.detail;ue||_t(e)}));function _t(t){var e=ue;try{ue=!0,me.storagemutated.fire(t)}finally{ue=e}}var ue=!1;if(typeof BroadcastChannel!="undefined"){var at=new BroadcastChannel(ve);typeof at.unref=="function"&&at.unref(),me(We,function(t){ue||at.postMessage(t)}),at.onmessage=function(t){t.data&&_t(t.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){me(We,function(t){try{ue||(typeof localStorage!="undefined"&&localStorage.setItem(ve,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&Pt([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(e){return e.postMessage({type:ve,changedParts:t})}))}catch{}}),typeof addEventListener!="undefined"&&addEventListener("storage",function(t){if(t.key===ve){var e=JSON.parse(t.newValue);e&&_t(e.changedParts)}});var Pn=self.document&&navigator.serviceWorker;Pn&&Pn.addEventListener("message",zi)}function zi(t){var e=t.data;e&&e.type===ve&&_t(e.changedParts)}A.rejectionMapper=Cr;Ln(ne,tr);class Wi{constructor(){R(this,"id");R(this,"colorThemeId");R(this,"distanceUnitId");R(this,"vehicleId",null);R(this,"plateNumberInTitleActive");R(this,"autoBackupActive");R(this,"autoBackupPath");R(this,"lastUpdateCheck")}}class fr{constructor(){R(this,"id");R(this,"name");R(this,"plateNumber");R(this,"currencyUnit");R(this,"fuelUnitId");R(this,"fuelUnit");R(this,"refuels")}}class Rt{constructor(){R(this,"id");R(this,"date");R(this,"refueledAmount");R(this,"payedAmount");R(this,"distanceDriven");R(this,"vehicleId");R(this,"vehicle")}}class Qi extends fr{constructor(){super(...arguments);R(this,"fuelConsumption")}}class Hi{constructor(){R(this,"id");R(this,"name");R(this,"active");R(this,"dateFrom");R(this,"dateUntil")}}class hr extends _n{constructor(){super("RefuelTrackerDb");R(this,"graphSettings");R(this,"vehicles");R(this,"refuels");R(this,"refuelFilters");R(this,"settings");this.version(1).stores({graphSettings:"++id, uid, sequence, periodId, visible",vehicles:"++id, name, plateNumber, fuelUnitId",refuels:"++id, date, refuelAmount, payedAmount, distanceDriven, vehicleId",settings:"++id, colorThemeId, distanceUnitId, vehicleId, plateNumberInTitleActive, autoBackupActive, autoBackupPath, lastUpdateCheck"}),this.version(2).stores({refuelFilters:"++id, name, active, dateFrom, dateUntil"}).upgrade(n=>(this.insertRefuelFilter(),n.table("settings").toCollection().modify(r=>{delete r.refuelFilterActive}))),this.on("populate",()=>{this.insertGraphSettings(),this.insertDemoData(),this.insertSettings(),this.insertRefuelFilter()})}insertGraphSettings(){[{uid:"1",sequence:1,visible:!0},{uid:"2",sequence:2,visible:!0},{uid:"3",sequence:3,visible:!0},{uid:"4",sequence:4,visible:!0},{uid:"5",sequence:5,visible:!0},{uid:"6",sequence:6,visible:!0}].forEach(r=>{(async()=>await this.graphSettings.put(r))()})}insertDemoData(){const n=new fr;n.name="My Vehicle",n.plateNumber="MYNUMBERPLATE",n.currencyUnit="\u20AC",n.fuelUnitId=1,(async()=>{n.id=await this.vehicles.put(n);const r=[];let i=new Rt;i.date=new Date,i.refueledAmount=33,i.payedAmount=55,i.distanceDriven=650,i.vehicleId=n.id,r.push(i),i=new Rt,i.date=new Date,i.refueledAmount=44,i.payedAmount=80,i.distanceDriven=900,i.vehicleId=n.id,r.push(i),i=new Rt,i.date=new Date,i.refueledAmount=50,i.payedAmount=90,i.distanceDriven=850,i.vehicleId=n.id,r.push(i),await this.refuels.bulkPut(r)})()}insertSettings(){const n=new Wi;n.vehicleId=1,n.colorThemeId=1,n.distanceUnitId=1,n.plateNumberInTitleActive=!1,n.autoBackupActive=!1,n.autoBackupPath="";const r=new Date;n.lastUpdateCheck=new Date(r.setDate(r.getDate()-365)),(async()=>await this.settings.put(n))()}insertRefuelFilter(){const n=new Hi;n.name="",n.active=!1,n.dateFrom=new Date,n.dateUntil=new Date,(async()=>await this.refuelFilters.put(n))()}}const Yi=new hr;var Xi=Object.freeze(Object.defineProperty({__proto__:null,RefuelTrackerDexie:hr,db:Yi},Symbol.toStringTag,{value:"Module"}));export{_n as D,Rt as R,fr as V,Qi as a,Xi as b,Yi as d};
