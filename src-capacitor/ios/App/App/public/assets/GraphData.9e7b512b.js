import{d as V,a1 as g,ac as D,f,a3 as S,aw as I,ax as T,ag as h,a8 as w,ab as y,ah as k,a6 as C,k as Q,r as G,a9 as M,c as x,aA as E,aB as P,o as U,a as z,a2 as _,a5 as b,aC as F,F as B,ad as O}from"./index.af9e0f6e.js";import{Q as L}from"./QPage.e5be6806.js";import{G as R,a as J}from"./GraphDataFactory.a6804de0.js";import{emitter as q}from"./mitt.4e333a4b.js";import{p as j}from"./package.b9b88699.js";import{u as N}from"./refuelStore.e71e446b.js";import{u as $}from"./settingsStore.5309004a.js";import{d as i}from"./dexie.e9b82229.js";import{o as H}from"./index.bf534033.js";import{u as K}from"./use-quasar.3f07aff8.js";import"./i18n.a8414de4.js";import"./fuelConsumption.8f4bd1ed.js";import"./QSpace.2d3c42d6.js";import"./ClosePopup.15002a59.js";const W={class:"row items-center no-wrap"},X={class:"col"},Y={class:"text-subtitle2"},Z={class:"col-auto space-station"},ee={class:"text-h4 accent-space-station"},te={class:"text-subtitle1"},ae=V({__name:"GraphCard",props:{graphData:{type:R,required:!0},periods:{type:Array,required:!0}},setup(t){return(v,d)=>(g(),D("div",null,[f(I,{class:"space-station"},{default:S(()=>[f(T,null,{default:S(()=>[h("div",W,[h("div",X,[h("div",Y,w(t.graphData.title),1)]),h("div",Z,[f(y,{dense:"",round:"",flat:"",icon:"more_vert",onClick:d[0]||(d[0]=m=>k(q).emit("showGraphOptionsDialog",t.graphData))})])]),h("div",null,[h("div",ee,w(t.graphData.value),1),h("div",te,w(t.graphData.unit),1)])]),_:1}),C("",!0),C("",!0)]),_:1})]))}}),se=Q("graphCardStore",()=>{const t=A();function v(o){(async()=>{let c=await t.getGraphSettings();const n=c.filter(a=>a.uid===o)[0],r=t.graphData.filter(a=>a.uid===o)[0];r.sequence=1,n.sequence=1,c=c.filter(a=>a.uid!==o).sort((a,s)=>a.sequence-s.sequence);const u=t.graphData.filter(a=>a.uid!==o).sort((a,s)=>a.sequence-s.sequence);await i.transaction("rw",[i.graphSettings],async()=>{const a=n.sequence,s=t.graphData.length;await i.graphSettings.update(n.id,{sequence:n.sequence}),t.graphData.length=0,t.graphData.push(r);for(let e=0;e<s-1;e++)await i.graphSettings.update(c[e].id,{sequence:e+a+1}),u[e].sequence=e+a+1,t.graphData.push(u[e])})})()}function d(o){(async()=>{const c=(await t.getGraphSettings()).sort((e,p)=>e.sequence-p.sequence),n=c.filter(e=>e.uid===o)[0],r=c.filter(e=>e.sequence===n.sequence-1)[0];if(!r)return Promise.resolve();const u=t.graphData.filter(e=>e.uid===o)[0],a=t.graphData.filter(e=>e.sequence===n.sequence-1)[0],s=r.sequence;r.sequence=n.sequence,n.sequence=s,await i.transaction("rw",[i.graphSettings],async()=>{await i.graphSettings.update(n.id,{sequence:n.sequence}),await i.graphSettings.update(r.id,{sequence:r.sequence}),a.sequence=r.sequence,u.sequence=s,t.graphData=t.graphData.sort((e,p)=>e.sequence-p.sequence)})})()}function m(o){(async()=>{const c=(await t.getGraphSettings()).sort((e,p)=>e.sequence-p.sequence),n=c.filter(e=>e.uid===o)[0],r=c.filter(e=>e.sequence===n.sequence+1)[0];if(!r)return Promise.resolve();const u=t.graphData.filter(e=>e.uid===o)[0],a=t.graphData.filter(e=>e.sequence===n.sequence+1)[0],s=r.sequence;r.sequence=n.sequence,n.sequence=s,await i.transaction("rw",[i.graphSettings],async()=>{await i.graphSettings.update(n.id,{sequence:n.sequence}),await i.graphSettings.update(r.id,{sequence:r.sequence}),a.sequence=r.sequence,u.sequence=s,t.graphData=t.graphData.sort((e,p)=>e.sequence-p.sequence)})})()}function l(o){(async()=>{let c=await t.getGraphSettings();const n=c.filter(a=>a.uid===o)[0],r=t.graphData.filter(a=>a.uid===o)[0];r.sequence=t.graphData.length,n.sequence=r.sequence,c=c.filter(a=>a.uid!==o).sort((a,s)=>a.sequence-s.sequence);const u=t.graphData.filter(a=>a.uid!==o).sort((a,s)=>a.sequence-s.sequence);await i.transaction("rw",[i.graphSettings],async()=>{const a=n.sequence;t.graphData.length=0;for(let s=0;s<a-1;s++)await i.graphSettings.update(c[s].id,{sequence:s+1}),u[s].sequence=s+1,t.graphData.push(u[s]);await i.graphSettings.update(n.id,{sequence:n.sequence}),t.graphData.push(r)})})()}return{moveTop:v,moveUp:d,moveDown:m,moveBottom:l}}),A=Q("graphDataStore",()=>{const t=G([]),v=se(),d=$(),m=N();async function l(){return await i.graphSettings.toArray()}async function o(){var n;if(!d.selectedVehicleId){t.value.length=0;return}const c=await m.getVehicle(d.selectedVehicleId);c&&((n=c.refuels)==null?void 0:n.length)?t.value=new J(c).getAll(await l()).sort((r,u)=>r.sequence-u.sequence):t.value.length=0}return{graphData:t,moveGraphCard:v,getGraphSettings:l,readGraphData:o}}),ne={key:0,class:"absolute-center items-center"},re={class:"row"},oe={key:1,class:"absolute-center"},ce={class:"row"},ke=V({__name:"GraphData",setup(t){K().dark.set("auto");const d=M(),m=N(),l=A(),o=$(),c=G(!1),n=G([]),r=x(()=>l.graphData),u=x(()=>o.selectedVehicleId),a=[{text:"Move top",icon:"keyboard_double_arrow_up",action:s=>l.moveGraphCard.moveTop(s.uid)},{text:"Move up",icon:"keyboard_arrow_up",action:s=>l.moveGraphCard.moveUp(s.uid)},{text:"Move down",icon:"keyboard_arrow_down",action:s=>l.moveGraphCard.moveDown(s.uid)},{text:"Move bottom",icon:"keyboard_double_arrow_down",action:s=>l.moveGraphCard.moveBottom(s.uid)}];return q.on("showGraphOptionsDialog",s=>H(a,s)),q.on("selectedVehicleChanged",()=>(()=>{l.readGraphData().then(()=>setTimeout(()=>c.value=!1,100)),c.value=!1})()),E(()=>{q.emit("updateTitle",(()=>{if(o.selectedVehicleId){if(o.plateNumberInTitleActive)return o.selectedVehiclePlateNumber}else return j.productName;return o.selectedVehicleName})())}),P(async()=>{n.value=await m.getPeriods()}),U(()=>{l.readGraphData()}),z(()=>{q.off("showGraphOptionsDialog"),q.off("selectedVehicleChanged")}),(s,e)=>(g(),_(L,{class:"items-center"},{default:S(()=>[u.value&&r.value.length===0?(g(),D("div",ne,[h("div",re,[f(b,{class:"col",name:"img:bar_chart.svg",size:"100px"})]),f(y,{color:"accent",label:"Add refuel","icon-right":"add",unelevated:"","no-caps":"",outline:"",onClick:e[0]||(e[0]=p=>k(d).push("/refuels/add"))})])):u.value?(g(),D(B,{key:2},[c.value?(g(),_(F,{key:0,class:"absolute-center",color:"primary",size:"3em",thickness:10})):(g(!0),D(B,{key:1},O(r.value,p=>(g(),_(ae,{key:p.uid,graphData:p,periods:n.value,class:"q-pt-md q-pl-md q-pr-md"},null,8,["graphData","periods"]))),128))],64)):(g(),D("div",oe,[h("div",ce,[f(b,{class:"col",name:"img:bar_chart.svg",size:"100px"})]),f(y,{class:"row",color:"accent",label:"Add vehicle","icon-right":"add",unelevated:"","no-caps":"",outline:"",onClick:e[1]||(e[1]=p=>k(d).push("/vehicles/add"))})]))]),_:1}))}});export{ke as default};
