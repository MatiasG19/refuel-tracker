"use strict";(self["webpackChunkrefuel_tracker"]=self["webpackChunkrefuel_tracker"]||[]).push([[727],{3727:(e,t,n)=>{n.r(t),n.d(t,{default:()=>J});var a=n(3673),i=n(1959),r=n(2323),c=n(721),o=n(1036);const s={class:"row items-center no-wrap"},u={class:"col"},d={class:"text-subtitle2"},l={class:"col-auto space-station"},h={class:"text-h4 accent-space-station"},p={class:"text-subtitle1"},g=(0,a.aZ)({props:{graphData:{type:c.K6,required:!0},periods:{type:Array,required:!0}},setup(e){return(t,n)=>{const c=(0,a.up)("q-btn"),g=(0,a.up)("q-card-section"),v=((0,a.up)("q-separator"),(0,a.up)("q-card-actions"),(0,a.up)("q-card"));return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(v,{class:"space-station"},{default:(0,a.w5)((()=>[(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[(0,a._)("div",s,[(0,a._)("div",u,[(0,a._)("div",d,(0,r.zw)(e.graphData.title),1)]),(0,a._)("div",l,[(0,a.Wm)(c,{dense:"",round:"",flat:"",icon:"more_vert",onClick:n[0]||(n[0]=t=>(0,i.SU)(o.emitter).emit("showGraphOptionsDialog",e.graphData))})])]),(0,a._)("div",null,[(0,a._)("div",h,(0,r.zw)(e.graphData.value),1),(0,a._)("div",p,(0,r.zw)(e.graphData.unit),1)])])),_:1}),(0,a.kq)("",!0),(0,a.kq)("",!0)])),_:1})])}}});var v=n(151),f=n(5589),q=n(8240),m=n(9367),w=n(5869),y=n(7518),b=n.n(y);const D=g,S=D;b()(g,"components",{QCard:v.Z,QCardSection:f.Z,QBtn:q.Z,QCardActions:m.Z,QSeparator:w.Z});var _=n(4147),k=n(4790),x=n(321),C=n(198),G=n(4745),I=function(e,t,n,a){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(a.next(e))}catch(t){r(t)}}function o(e){try{s(a["throw"](e))}catch(t){r(t)}}function s(e){e.done?n(e.value):i(e.value).then(c,o)}s((a=a.apply(e,t||[])).next())}))};const Z=(0,x.Q_)("graphCardStore",(()=>{const e=P();function t(t){(()=>{I(this,void 0,void 0,(function*(){let n=yield e.getGraphSettings();const a=n.filter((e=>e.uid===t))[0],i=e.graphData.filter((e=>e.uid===t))[0];i.sequence=1,a.sequence=1,n=n.filter((e=>e.uid!==t)).sort(((e,t)=>e.sequence-t.sequence));const r=e.graphData.filter((e=>e.uid!==t)).sort(((e,t)=>e.sequence-t.sequence));yield C.db.transaction("rw",[C.db.graphSettings],(()=>I(this,void 0,void 0,(function*(){const t=a.sequence,c=e.graphData.length;yield C.db.graphSettings.update(a.id,{sequence:a.sequence}),e.graphData.length=0,e.graphData.push(i);for(let a=0;a<c-1;a++)yield C.db.graphSettings.update(n[a].id,{sequence:a+t+1}),r[a].sequence=a+t+1,e.graphData.push(r[a])}))))}))})()}function n(t){(()=>{I(this,void 0,void 0,(function*(){const n=(yield e.getGraphSettings()).sort(((e,t)=>e.sequence-t.sequence)),a=n.filter((e=>e.uid===t))[0],i=n.filter((e=>e.sequence===a.sequence-1))[0];if(!i)return Promise.resolve();const r=e.graphData.filter((e=>e.uid===t))[0],c=e.graphData.filter((e=>e.sequence===a.sequence-1))[0],o=i.sequence;i.sequence=a.sequence,a.sequence=o,yield C.db.transaction("rw",[C.db.graphSettings],(()=>I(this,void 0,void 0,(function*(){yield C.db.graphSettings.update(a.id,{sequence:a.sequence}),yield C.db.graphSettings.update(i.id,{sequence:i.sequence}),c.sequence=i.sequence,r.sequence=o,e.graphData=e.graphData.sort(((e,t)=>e.sequence-t.sequence))}))))}))})()}function a(t){(()=>{I(this,void 0,void 0,(function*(){const n=(yield e.getGraphSettings()).sort(((e,t)=>e.sequence-t.sequence)),a=n.filter((e=>e.uid===t))[0],i=n.filter((e=>e.sequence===a.sequence+1))[0];if(!i)return Promise.resolve();const r=e.graphData.filter((e=>e.uid===t))[0],c=e.graphData.filter((e=>e.sequence===a.sequence+1))[0],o=i.sequence;i.sequence=a.sequence,a.sequence=o,yield C.db.transaction("rw",[C.db.graphSettings],(()=>I(this,void 0,void 0,(function*(){yield C.db.graphSettings.update(a.id,{sequence:a.sequence}),yield C.db.graphSettings.update(i.id,{sequence:i.sequence}),c.sequence=i.sequence,r.sequence=o,e.graphData=e.graphData.sort(((e,t)=>e.sequence-t.sequence))}))))}))})()}function i(t){(()=>{I(this,void 0,void 0,(function*(){let n=yield e.getGraphSettings();const a=n.filter((e=>e.uid===t))[0],i=e.graphData.filter((e=>e.uid===t))[0];i.sequence=e.graphData.length,a.sequence=i.sequence,n=n.filter((e=>e.uid!==t)).sort(((e,t)=>e.sequence-t.sequence));const r=e.graphData.filter((e=>e.uid!==t)).sort(((e,t)=>e.sequence-t.sequence));yield C.db.transaction("rw",[C.db.graphSettings],(()=>I(this,void 0,void 0,(function*(){const t=a.sequence;e.graphData.length=0;for(let a=0;a<t-1;a++)yield C.db.graphSettings.update(n[a].id,{sequence:a+1}),r[a].sequence=a+1,e.graphData.push(r[a]);yield C.db.graphSettings.update(a.id,{sequence:a.sequence}),e.graphData.push(i)}))))}))})()}return{moveTop:t,moveUp:n,moveDown:a,moveBottom:i}}));var A=function(e,t,n,a){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(a.next(e))}catch(t){r(t)}}function o(e){try{s(a["throw"](e))}catch(t){r(t)}}function s(e){e.done?n(e.value):i(e.value).then(c,o)}s((a=a.apply(e,t||[])).next())}))};const P=(0,x.Q_)("graphDataStore",(()=>{const e=(0,i.iH)([]),t=Z(),n=(0,k.F)(),a=(0,k.n)();function r(){return A(this,void 0,void 0,(function*(){return yield C.db.graphSettings.toArray()}))}function c(){var t;return A(this,void 0,void 0,(function*(){if(!n.selectedVehicleId)return void(e.value.length=0);const i=yield a.getVehicle(n.selectedVehicleId);i&&(null===(t=i.refuels)||void 0===t?void 0:t.length)?e.value=new G.d(i).getAll(yield r()).sort(((e,t)=>e.sequence-t.sequence)):e.value.length=0}))}return{graphData:e,moveGraphCard:t,getGraphSettings:r,readGraphData:c}}));var Q=function(e,t,n,a){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(a.next(e))}catch(t){r(t)}}function o(e){try{s(a["throw"](e))}catch(t){r(t)}}function s(e){e.done?n(e.value):i(e.value).then(c,o)}s((a=a.apply(e,t||[])).next())}))};function U(){const e=(0,k.F)();(()=>{Q(this,void 0,void 0,(function*(){const t=yield C.db.settings.toArray();if(!t[0])return Promise.resolve();if(e.changeColorTheme(t[0].colorThemeId),e.changeDistanceUnit(t[0].distanceUnitId),t[0].vehicleId){const n=yield C.db.vehicles.where("id").equals(t[0].vehicleId).toArray();e.changeSelectedVehicle(n[0])}e.togglePlateNumberInTitle(t[0].plateNumberInTitleActive)}))})()}var V=n(8498),T=n(8825),W=n(5366),z=n(9582),F=function(e,t,n,a){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(a.next(e))}catch(t){r(t)}}function o(e){try{s(a["throw"](e))}catch(t){r(t)}}function s(e){e.done?n(e.value):i(e.value).then(c,o)}s((a=a.apply(e,t||[])).next())}))};const N={key:0,class:"absolute-center items-center"},H={class:"row"},B={key:1,class:"absolute-center"},M={class:"row"},j=(0,a.aZ)({setup(e){const t=(0,T.Z)();t.dark.set("auto");const n=(0,z.tv)(),r=(0,k.n)(),c=P(),s=(0,k.F)(),u=(0,W.V)(),d=(0,i.iH)(!1),l=(0,i.iH)([]),h=(0,i.Fl)((()=>c.graphData)),p=(0,i.Fl)((()=>s.selectedVehicleId)),g=[{text:"Move top",icon:"keyboard_double_arrow_up",action:e=>c.moveGraphCard.moveTop(e.uid)},{text:"Move up",icon:"keyboard_arrow_up",action:e=>c.moveGraphCard.moveUp(e.uid)},{text:"Move down",icon:"keyboard_arrow_down",action:e=>c.moveGraphCard.moveDown(e.uid)},{text:"Move bottom",icon:"keyboard_double_arrow_down",action:e=>c.moveGraphCard.moveBottom(e.uid)}];return o.emitter.on("showGraphOptionsDialog",(e=>(0,V.o)(g,e))),o.emitter.on("selectedVehicleChanged",(()=>(()=>{c.readGraphData().then((()=>setTimeout((()=>d.value=!1),100))),d.value=!1})())),(0,a.m0)((()=>{o.emitter.emit("updateTitle",(()=>s.selectedVehicleId?s.plateNumberInTitleActive?s.selectedVehiclePlateNumber:s.selectedVehicleName:_.productName)())})),(0,a.wF)((()=>F(this,void 0,void 0,(function*(){U(),l.value=yield r.getPeriods()})))),(0,a.bv)((()=>{u(),c.readGraphData()})),(0,a.Ah)((()=>{o.emitter.off("showGraphOptionsDialog"),o.emitter.off("selectedVehicleChanged")})),(e,t)=>{const r=(0,a.up)("q-icon"),c=(0,a.up)("q-btn"),o=(0,a.up)("q-spinner"),s=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(s,{class:"items-center"},{default:(0,a.w5)((()=>[(0,i.SU)(p)&&0===(0,i.SU)(h).length?((0,a.wg)(),(0,a.iD)("div",N,[(0,a._)("div",H,[(0,a.Wm)(r,{class:"col",name:"img:bar_chart.svg",size:"100px"})]),(0,a.Wm)(c,{color:"accent",label:"Add refuel","icon-right":"add",unelevated:"","no-caps":"",outline:"",onClick:t[0]||(t[0]=e=>(0,i.SU)(n).push("/refuels/add"))})])):(0,i.SU)(p)?((0,a.wg)(),(0,a.iD)(a.HY,{key:2},[d.value?((0,a.wg)(),(0,a.j4)(o,{key:0,class:"absolute-center",color:"primary",size:"3em",thickness:10})):((0,a.wg)(!0),(0,a.iD)(a.HY,{key:1},(0,a.Ko)((0,i.SU)(h),(e=>((0,a.wg)(),(0,a.j4)(S,{key:e.uid,graphData:e,periods:l.value,class:"q-pt-md q-pl-md q-pr-md"},null,8,["graphData","periods"])))),128))],64)):((0,a.wg)(),(0,a.iD)("div",B,[(0,a._)("div",M,[(0,a.Wm)(r,{class:"col",name:"img:bar_chart.svg",size:"100px"})]),(0,a.Wm)(c,{class:"row",color:"accent",label:"Add vehicle","icon-right":"add",unelevated:"","no-caps":"",outline:"",onClick:t[1]||(t[1]=e=>(0,i.SU)(n).push("/vehicles/add"))})]))])),_:1})}}});var O=n(4379),K=n(4554),Y=n(9754);const E=j,J=E;b()(j,"components",{QPage:O.Z,QIcon:K.Z,QBtn:q.Z,QSpinner:Y.Z})}}]);